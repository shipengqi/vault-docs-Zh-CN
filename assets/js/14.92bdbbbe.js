(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{158:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),s("p",[t._v("Secrets 引擎是存储、生成或加密数据的组件。Secrets 引擎是非常灵活的，所以从它们的功能而言是很容易理解的。Secrets 引擎提供了一些数据集，它们对这些数据\n执行一些操作，然后返回一个结果。")]),t._v(" "),s("p",[t._v("一些 Secrets 引擎只是简单地存储和读取数据——比如加密的 Redis/Memcached 。其他 Secrets 引擎连接到其他服务，并根据需要生成动态凭据。其他 Secrets 引擎\n提供加密服务、totp 生成、证书等等。")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),s("p",[t._v('大多数 Secrets 引擎都可以通过 CLI 或 API 启用、禁用、调优和移动。Vault 以前的版本将这些称为 "mount"，但是这个术语已经被覆盖了。')]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),s("p",[t._v("secret 引擎接受一个 "),s("code",[t._v("barrier view")]),t._v(" 已配置的 vault 物理存储。这很像 "),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Chroot",target:"_blank",rel:"noopener noreferrer"}},[t._v("chroot"),s("OutboundLink")],1),t._v("。")]),t._v(" "),t._m(8),t._v(" "),s("p",[t._v("这是 Vault 中一个重要的安全特性 —— 即使一个恶意的引擎也不能访问任何其他引擎的数据。")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),s("p",[t._v("当一个版本被删除时，底层数据并没有被删除，而是被标记为已删除。已删除的版本可以取消删除。要永久删除版本的数据，可以使用 destroy 命令或 API 端点。\n此外，可以通过删除 metadata 命令或 API 端点删除 key 的所有版本和元数据。每个操作都可以采用不同的 ACL'ed，从而限制谁具有软删除、取消删除或完全删除数据的权限。")]),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),s("p",[t._v("key 名必须始终是字符串。如果直接通过 CLI 编写非字符串值，它们将被转换成字符串。")]),t._v(" "),s("p",[t._v("但是，可以通过编写保存非字符串值的 key/value 对的 JSON 文件传递给 Vault，或使用 HTTP API 进行调用。")]),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._m(30),t._v(" "),t._m(31),t._m(32),t._v(" "),t._m(33),t._m(34),t._v(" "),t._m(35),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._m(40),t._v(" "),t._m(41),t._v(" "),t._m(42),t._m(43),t._v(" "),t._m(44),t._v(" "),s("p",[t._v("一个 v2 版本的 secret 引擎可以使用下面的命令启用：")]),t._v(" "),t._m(45),t._m(46),t._v(" "),t._m(47),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),s("p",[t._v("或者通过 API：")]),t._v(" "),t._m(54),t._m(55),t._v(" "),s("p",[t._v("版本 2 kv 存储使用前缀 API，这与版本 1 API不同。在从版本 1 kv 升级之前，应该更改 ACL 规则。此外，版本 2 API 中的不同路径可以采用不同的 ACL'ed。")]),t._v(" "),t._m(56),t._v(" "),t._m(57),s("p",[t._v("需要改为：")]),t._v(" "),t._m(58),s("p",[t._v("这个后端有不同级别的数据删除。若要授予策略删除 key 最新版本的权限，请:")]),t._v(" "),t._m(59),s("p",[t._v("允许策略删除任何版本的 key:")]),t._v(" "),t._m(60),s("p",[t._v("允许策略取消删除数据:")]),t._v(" "),t._m(61),s("p",[t._v("允许策略销毁版本:")]),t._v(" "),t._m(62),s("p",[t._v("允许策略列出所有的 key:")]),t._v(" "),t._m(63),s("p",[t._v("允许策略读取每个版本的元数据:")]),t._v(" "),t._m(64),s("p",[t._v("允许策略永久删除 key 的所有版本和元数据:")]),t._v(" "),t._m(65),t._m(66),t._v(" "),t._m(67),t._v(" "),t._m(68),t._v(" "),t._m(69),t._m(70),t._v(" "),t._m(71),t._m(72),t._v(" "),t._m(73),t._m(74),t._v(" "),t._m(75),t._m(76),t._v(" "),t._m(77),t._m(78),t._v(" "),t._m(79),t._v(" "),t._m(80),t._v(" "),s("p",[t._v("有关更多信息，参阅下面的命令:")]),t._v(" "),t._m(81),t._v(" "),t._m(82),t._m(83),t._v(" "),t._m(84),t._m(85),t._v(" "),t._m(86),t._m(87),t._v(" "),s("p",[t._v("可以使用 metadata 命令 & API跟 踪所有版本和 key 元数据。删除元数据 key 将导致永久删除该 key 的所有元数据和版本。")]),t._v(" "),s("p",[t._v("有关更多信息，参阅下面的命令:")]),t._v(" "),t._m(88),t._v(" "),t._m(89),t._m(90),t._v(" "),t._m(91),s("p",[t._v("最大版本的变化适用于下一个写操作:")]),t._v(" "),t._m(92),s("p",[t._v("一旦一个 key 的版本数量超过最大版本数，最老的版本就会被清除:")]),t._v(" "),t._m(93),t._m(94),t._v(" "),t._m(95),t._m(96),t._v(" "),t._m(97),t._v(" "),s("p",[t._v("通过保持相对较短的 TTL，不太可能需要撤销操作，保持 CRL 简短并帮助 secrets 引擎扩展到大型工作负载。 反过来就允许每个正在运行的应用程序实例都具有唯一的证书，\n从而消除了共享以及随之而来的撤销和反复的痛苦。")]),t._v(" "),s("p",[t._v("此外，允许撤销操作主要是放弃证书，这个 secrets 引擎允许短暂的证书。应用程序启动时可以获取证书并将其存储在内存中，并在关闭时丢弃，而不必写入磁盘。")]),t._v(" "),t._m(98),t._v(" "),s("p",[t._v("大多数 secrets 引擎必须事先配置才能执行其功能。 这些步骤通常由操作员或配置管理工具完成。")]),t._v(" "),t._m(99),t._v(" "),t._m(100),t._m(101),t._v(" "),t._m(102),t._v(" "),t._m(103),s("p",[t._v("注意，这只是配置这个 secrets 引擎的全局的最大值。每个角色可以把每个证书的 TTL 限制为更短。")]),t._v(" "),t._m(104),t._v(" "),t._m(105),s("p",[t._v("返回的证书纯粹是提供信息。 私钥安全地存储在 Vault 内部。")]),t._v(" "),t._m(106),t._v(" "),t._m(107),t._m(108),t._v(" "),t._m(109),t._m(110),t._v(" "),t._m(111),t._v(" "),t._m(112),t._v(" "),t._m(113),t._m(114),t._v(" "),t._m(115),t._v(" "),s("p",[t._v("要成功部署这个 secrets 引擎，需要考虑到一些重要的因素，以及应该采取的一些准备步骤。 在使用这个 secrets 引擎或生成 CA 以使用此 secrets 引擎之前，应该阅读所有这些内容。")]),t._v(" "),t._m(116),t._v(" "),t._m(117),t._v(" "),t._m(118),t._v(" "),t._m(119),t._v(" "),t._m(120),t._v(" "),s("p",[t._v("为了简化 PKI secrets 引擎的配置和代码库，每个 secrets 引擎只允许一个 CA 证书。 如果要从多个 CA 颁发证书，将 PKI secrets 引擎安装在多个安装点，每个安装点都\n有单独的 CA 证书。")]),t._v(" "),s("p",[t._v("这也提供了一种切换到新 CA 证书的便捷方法，同时保持 CRL 对旧 CA 证书有效; 只需安装一个新的 secrets 引擎并从那里发出。")]),t._v(" "),t._m(121),t._v(" "),t._m(122),t._v(" "),s("p",[t._v("这个 secrets 引擎与 Vault 短暂的 secrets 理念保持一致。 因此，预计 CRL 不会增长; 唯一返回私钥的地方是请求客户端（此 secrets 引擎不存储生成的私钥，CA 证书除外）。\n在大多数情况下，如果密钥丢失，则可以简单地忽略证书，因为它很快就会过期。")]),t._v(" "),s("p",[t._v("如果必须撤销证书，则可以使用正常的 Vault 撤销功能; 或者，可以使用根令牌来使用证书的序列号撤销证书。任何撤销操作都将导致重新生成 CRL。重新生成 CRL 时，将从 CRL 中删除所\n有过期的证书（并且从 secrets 引擎存储中删除任何已撤销的过期证书）。")]),t._v(" "),s("p",[t._v("这个 secrets 引擎不支持具有滑动日期窗口的多个 CRL 端点; 通常这样的机制将具有相隔几天的转换点，但是这进入了从这个 secrets 引擎发出的实际证书有效期的预期范围。\n这个 secrets 引擎的一个好的经验法则是不发布有效期大于最大舒适 CRL 生命周期的证书。 或者，可以控制客户端上的CRL缓存行为，以确保更频繁地进行检查。")]),t._v(" "),s("p",[t._v("通常在单个 CRL 端点关闭时使用多个端点，以便客户端不必弄清楚如何处理缺少响应。 在 HA 模式下运行 Vault，即使特定节点关闭，CRL 端点也应可用。")]),t._v(" "),t._m(123),t._v(" "),t._m(124),t._v(" "),t._m(125),t._v(" "),s("p",[t._v("自成立以来，这个秘密引擎已经强制使用 SHA256 签名哈希而不是 SHA1。 从 0.5.1 开始，RSA 密钥的最小值为 2048 位。 可以处理 SHA256 签名的软件也应该能够处理 2048 位密钥，\n并且 1024 位密钥被认为是不安全的，并且在 Internet PKI 中是不允许的。")]),t._v(" "),t._m(126),t._v(" "),t._m(127),t._v(" "),t._m(128),t._v(" "),t._m(129),t._v(" "),t._m(130),t._v(" "),t._m(131),t._m(132),t._v(" "),t._m(133),t._v(" "),s("p",[t._v("通常，希望根证书仅用于签署 CA 中间证书，但是对于此示例，我们将继续执行，将直接从根颁发证书。 因为它是根，我们要为证书设置一个很长的最大生命周期; 首先调整：")]),t._v(" "),t._m(134),t._m(135),t._v(" "),s("p",[t._v("现在，生成根证书：")]),t._v(" "),t._m(136),s("p",[t._v("返回的证书纯粹是信息性的; 它及其私钥安全地存储在后端挂载中。")]),t._v(" "),t._m(137),t._v(" "),s("p",[t._v("生成的证书可以具有 CRL 位置和颁发证书编码的位置。 这些值必须手动设置，通常设置为与 Vault 服务器关联的 FQDN，但可以随时更改。")]),t._v(" "),t._m(138),t._m(139),t._v(" "),t._m(140),t._v(" "),t._m(141),t._m(142),t._v(" "),t._m(143),t._v(" "),t._m(144),t._m(145),t._v(" "),t._m(146),t._v(" "),t._m(147),t._v(" "),t._m(148),t._v(" "),s("p",[t._v("在快速入门指南中，证书直接从根证书颁发机构颁发。 如示例中所述，这不是推荐的做法。本指南以先前指南的根证书颁发机构为基础，使用根权限创建中间权限以签署中间证书。")]),t._v(" "),t._m(149),t._v(" "),s("p",[t._v("要将另一个证书颁发机构添加到 Vault 实例，我们必须将其安装在其他路径上。")]),t._v(" "),t._m(150),t._m(151),t._v(" "),t._m(152),s("p",[t._v("这里将最大 TTL 设置为5年。 此值应小于或等于根证书颁发机构。")]),t._v(" "),s("p",[t._v("现在，我们生成中间证书签名请求")]),t._v(" "),t._m(153),s("p",[t._v("从中间权限获取签名请求，并使用另一个证书颁发机构对其进行签名，在本例中为第一个示例中生成的根证书颁发机构。")]),t._v(" "),t._m(154),s("p",[t._v("现在将中间证书颁发机构签名证书设置为根签名证书。")]),t._v(" "),t._m(155),s("p",[t._v("现在配置好了中间证书颁发机构，并且可以颁发证书。")]),t._v(" "),t._m(156),t._v(" "),s("p",[t._v("生成的证书可以具有 CRL 位置和颁发证书编码的位置。 这些值必须手动设置，但可以随时更改。")]),t._v(" "),t._m(157),t._m(158),t._v(" "),t._m(159),t._v(" "),t._m(160),t._m(161),t._v(" "),t._m(162),t._v(" "),t._m(163),t._m(164),t._v(" "),t._m(165),t._v(" "),t._m(166)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"secrets-引擎"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#secrets-引擎","aria-hidden":"true"}},[this._v("#")]),this._v(" Secrets 引擎")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"overview"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#overview","aria-hidden":"true"}},[this._v("#")]),this._v(" Overview")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Secrets 引擎在 Vault 中的一个 "),e("code",[this._v("path")]),this._v(" 上启用。当一个请求到达 Vault 时，路由器自动将带有路由前缀的任何东西路由到 secret 引擎。通过这种方式，\n每个 secret 引擎都定义了自己的路径和属性。对于用户来说，secret 引擎的行为类似于虚拟文件系统，支持读、写和删除等操作。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"secrets-engines-lifecycle"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#secrets-engines-lifecycle","aria-hidden":"true"}},[this._v("#")]),this._v(" Secrets Engines Lifecycle")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("Enable")]),t._v(" - 这将在给定的路径上启用 secret 引擎。除了少数例外，secrets 引擎可以在多个路径上启用。每个 secret 引擎都与它的路径隔离。默认情况下，\n它们在与 "),s("code",[t._v("type")]),t._v(" 相同的路径上是启用的(例如。"),s("code",[t._v("aws")]),t._v(" 默认启用于 "),s("code",[t._v("aws/")]),t._v(" 上)。")]),t._v(" "),s("li",[s("code",[t._v("Disable")]),t._v(" - 这将禁用现有的 secrets 引擎。当一个 secrets 引擎被禁用时，它的所有 secrets 都会被撤销(如果它们支持的话)，并且在物理存储层中为该引\n擎存储的所有数据都会被删除。")]),t._v(" "),s("li",[s("code",[t._v("Move")]),t._v(" - 这将移动现有的 secrets 引擎的 path。这个过程撤销所有 secrets ，因为 secrets 租约与创建它们的 path 绑定在一起。为引擎存储的配置数据\n在移动过程中保持不变。")]),t._v(" "),s("li",[s("code",[t._v("Tune")]),t._v(" - 这将调整 Secrets 引擎(如 TTLs )的全局配置。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("一旦一个 secret 引擎被启用，就可以根据它自己的 API 在它的路径上直接与它交互。使用 "),e("code",[this._v("vault path -help")]),this._v(" 确定它响应的路径。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("注意，Vault 中的挂载点不能相互冲突。这个事实有两个广泛的含义。首先，你不能有一个以已存在的挂载为前缀的挂载。第二，你不能创建一个名为已存在的挂载前缀的挂载点。\n例如，挂载 "),s("code",[t._v("foo/bar")]),t._v(" 和 "),s("code",[t._v("foo/baz")]),t._v(" 可以和平共处，而 "),s("code",[t._v("foo")]),t._v(" 和 "),s("code",[t._v("foo/baz")]),t._v(" 则不能")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"barrier-view"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#barrier-view","aria-hidden":"true"}},[this._v("#")]),this._v(" Barrier View")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("当启用 secret 引擎时，将生成一个随机 UUID。这将成为该引擎的数据根。每当该引擎写入物理存储层时，它都以该 UUID 文件夹作为前缀。\n由于 Vault 存储层不支持相对访问(例如 "),e("code",[this._v("../")]),this._v(")，这使得启用的 secret 引擎不可能访问其他数据。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"kv-secrets-engine"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kv-secrets-engine","aria-hidden":"true"}},[this._v("#")]),this._v(" KV Secrets Engine")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"overview-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#overview-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Overview")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("kv")]),this._v(" Secrets 引擎用于存储任意的 secrets 到 Vault 配置的物理存储中。此后端可以以两种模式之一运行。它可以是一个通用的 "),e("code",[this._v("Key-Value")]),this._v(" 存储，存储健值对。\n可以启用版本控制，并为每个 key 存储可配置的版本号。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"kv-version-1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kv-version-1","aria-hidden":"true"}},[this._v("#")]),this._v(" KV Version 1")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("当运行 "),e("code",[this._v("kv")]),this._v(" secret backend 无版本控制时，仅保留 key 的最近写入值。无版本 "),e("code",[this._v("kv")]),this._v(" 的好处是减少了每个 key 的存储大小，因为不存储额外的元数据或历史记录。\n此外，通过这种方式配置到后端的请求将具有更高的性能，因为对于任何给定的请求，将有更少的存储调用，并且没有锁定。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("有关在这种模式下运行的更多信息可以在 "),e("a",{attrs:{href:""}},[this._v("K/V Version 1 Docs")]),this._v(" 中找到。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"kv-version-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kv-version-2","aria-hidden":"true"}},[this._v("#")]),this._v(" KV Version 2")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("当运行 v2 版本的 "),e("code",[this._v("kv")]),this._v(" 后端时，key 可以保留一定数量可配置的版本。默认为 10 个版本。可以检索旧版本的元数据和数据。此外，可以使用 "),e("code",[this._v("Check-and-Set")]),this._v(" 操作来避免无意中覆盖数据。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("有关在这种模式下运行的更多信息可以在 "),e("a",{attrs:{href:""}},[this._v("K/V Version 2 Docs")]),this._v(" 中找到。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"kv-secrets-engine-version-1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kv-secrets-engine-version-1","aria-hidden":"true"}},[this._v("#")]),this._v(" KV Secrets Engine - Version 1")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("kv")]),this._v(" Secrets 引擎用于存储任意的 secrets 到 Vault 配置的物理存储中。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("写入一个 key 到 "),e("code",[this._v("kv")]),this._v(" 后端会替换旧值;子字段不会合并在一起。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("这个 secret 引擎支持 ACL 策略中的 "),e("code",[this._v("create")]),this._v(" 和 "),e("code",[this._v("update")]),this._v(" 功能之间的区别。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("Path 和 key 名是不会被加密的，只有 key 的值会被加密。不应该将敏感信息存储在 secret 的 path 中。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"setup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup","aria-hidden":"true"}},[this._v("#")]),this._v(" Setup")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("启用一个版本为 1 的 "),e("code",[this._v("kv")]),this._v(" 存储：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("vault secrets enable -version=1 kv\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"usage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#usage","aria-hidden":"true"}},[this._v("#")]),this._v(" Usage")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在配置了 secret 引擎并且 用户/机器 具有具有适当权限的 Vault 令牌之后，它可以生成凭证。"),e("code",[this._v("kv")]),this._v(" secret 引擎允许写入任意的健值对。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("写入任意数据：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv put kv/my-secret my-value=s3cr3t\nSuccess! Data written to: kv/my-secret\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("读取任意数据：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv get kv/my-secret\nKey                 Value\n---                 -----\nmy-value            s3cr3t\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"3"}},[e("li",[this._v("列出所有的 keys：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv list kv/\nKeys\n----\nmy-secret\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"4"}},[e("li",[this._v("删除一个 key：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv delete kv/my-secret\nSuccess! Data deleted (if it existed) at: kv/my-secret\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"ttls"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ttls","aria-hidden":"true"}},[this._v("#")]),this._v(" TTLs")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("和其他 secret 引擎不同， "),e("code",[this._v("kv")]),this._v(" secret 引擎不强制 TTLs 过期。相反，"),e("code",[this._v("lease_duration")]),this._v(" 只是为了提示使用者应该多久检查一次新值。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("若一个 key 提供了 "),e("code",[this._v("ttl")]),this._v("，KV secret 引擎将以此值作为租期:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv put kv/my-secret ttl=30m my-value=s3cr3t\nSuccess! Data written to: kv/my-secret\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("即使设置了 "),e("code",[this._v("ttl")]),this._v("，secret 引擎也不会自己删除数据。"),e("code",[this._v("ttl")]),this._v(" 的关键仅仅是建议。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("当读取一个带有 "),e("code",[this._v("ttl")]),this._v(" 的值时，"),e("code",[this._v("ttl")]),this._v(" 键和刷新间隔都会显示:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv get kv/my-secret\nKey                 Value\n---                 -----\nmy-value            s3cr3t\nttl                 30m\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"kv-secrets-engine-version-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kv-secrets-engine-version-2","aria-hidden":"true"}},[this._v("#")]),this._v(" KV Secrets Engine - Version 2")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"setup-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Setup")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault secrets enable -version=2 kv\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("或者，你可以通过 "),e("code",[this._v("kv-v2")]),this._v(" 作为 secret 引擎类型:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault secrets enable kv-v2\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("此外，当运行一个 dev-mode 服务器时，默认情况下在路径 "),e("code",[this._v("secret/")]),this._v(" 上启用了v2 kv secret 引擎(对于非开发服务器，当前为 v1)。可以在不同的路径上多次禁用、移动或启用它。\nKV secret 引擎的每个实例都是独立且唯一的。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"upgrading-from-version-1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#upgrading-from-version-1","aria-hidden":"true"}},[this._v("#")]),this._v(" Upgrading from Version 1")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("现有版本 1 的 "),e("code",[this._v("kv")]),this._v(" 存储可以通过 CLI 或 API 升级到版本 2，如下所示。这将启动一个升级过程，将现有的 key/value 数据升级为版本化的格式。在此过程中，\n挂载将不可访问。这个过程可能需要很长时间，所以要相应地计划。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("一旦升级到版本 2，以前数据可访问的路径不可以再满足。你需要调整用户策略，以添加对 version 2 路径的访问，详细介绍 "),e("a",{attrs:{href:""}},[this._v("the ACL Rules section")]),this._v("。\n同样，一旦 kv 数据升级到版本 2，用户/应用程序 将需要更新与 kv 数据交互的路径。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("现有版本 1 的 "),e("code",[this._v("kv")]),this._v(" 存储可以通过 CLI 升级到版本 2:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv enable-versioning secret/\nSuccess! Tuned the secrets engine at: secret/\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('$ cat payload.json\n{\n  "options": {\n      "version": "2"\n  }\n}\n\n$ curl \\\n    --header "X-Vault-Token: ..." \\\n    --request POST \\\n    --data @payload.json \\\n    http://127.0.0.1:8200/v1/sys/mounts/secret/tune\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"acl-rules"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#acl-rules","aria-hidden":"true"}},[this._v("#")]),this._v(" ACL Rules")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("写入和读取版本的前缀是 "),e("code",[this._v("data/")]),this._v(" 的路径。适用于 1 kv 版本的策略:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('path "secret/dev/team-1/*" {\n  capabilities = ["create", "update", "read"]\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('path "secret/data/dev/team-1/*" {\n  capabilities = ["create", "update", "read"]\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('path "secret/data/dev/team-1/*" {\n  capabilities = ["delete"]\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('path "secret/delete/dev/team-1/*" {\n  capabilities = ["update"]\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('path "secret/undelete/dev/team-1/*" {\n  capabilities = ["update"]\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('path "secret/destroy/dev/team-1/*" {\n  capabilities = ["update"]\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('path "secret/metadata/dev/team-1/*" {\n  capabilities = ["list"]\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('path "secret/metadata/dev/team-1/*" {\n  capabilities = ["read"]\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('path "secret/metadata/dev/team-1/*" {\n  capabilities = ["delete"]\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"usage-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#usage-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Usage")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"writing-reading-arbitrary-data"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#writing-reading-arbitrary-data","aria-hidden":"true"}},[this._v("#")]),this._v(" Writing/Reading arbitrary data")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("写入任意数据：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv put secret/my-secret my-value=s3cr3t\nKey              Value\n---              -----\ncreated_time     2018-03-30T22:11:48.589157362Z\ndeletion_time    n/a\ndestroyed        false\nversion          1\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("读取任意数据：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv get secret/my-secret\n====== Metadata ======\nKey              Value\n---              -----\ncreated_time     2018-03-30T22:11:48.589157362Z\ndeletion_time    n/a\ndestroyed        false\nversion          1\n\n====== Data ======\nKey         Value\n---         -----\nmy-value    s3cr3t\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",{attrs:{start:"3"}},[s("li",[t._v("写入另一个版本，仍然可以访问以前的版本。可以选择传递 "),s("code",[t._v("-cas")]),t._v(" 标志来执行 "),s("code",[t._v("check-and-set")]),t._v(" 操作。如果没有设置，那么写操作是允许的。如果设置 "),s("code",[t._v("-cas=0")]),t._v("，则仅在 key 不存在的情况下才\n允许写入。如果索引非零，则仅当 key 的当前版本与 "),s("code",[t._v("cas")]),t._v(" 参数中指定的版本匹配时才允许写入。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv put -cas=1 secret/my-secret my-value=new-s3cr3t\nKey              Value\n---              -----\ncreated_time     2018-03-30T22:18:37.124228658Z\ndeletion_time    n/a\ndestroyed        false\nversion          2\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"4"}},[e("li",[this._v("现在读取将返回最新版本的数据:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv get secret/my-secret\n====== Metadata ======\nKey              Value\n---              -----\ncreated_time     2018-03-30T22:18:37.124228658Z\ndeletion_time    n/a\ndestroyed        false\nversion          2\n\n====== Data ======\nKey         Value\n---         -----\nmy-value    new-s3cr3t\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"5"}},[e("li",[this._v("之前的版本可以通过 "),e("code",[this._v("-version")]),this._v(" 标志来访问：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv get -version=1 secret/my-secret\n====== Metadata ======\nKey              Value\n---              -----\ncreated_time     2018-03-30T22:16:39.808909557Z\ndeletion_time    n/a\ndestroyed        false\nversion          1\n\n====== Data ======\nKey         Value\n---         -----\nmy-value    s3cr3t\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"deleting-and-destroying-data"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deleting-and-destroying-data","aria-hidden":"true"}},[this._v("#")]),this._v(" Deleting and Destroying Data")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("当执行标准命令 "),s("code",[t._v("vault kv delete")]),t._v(" 删除数据时会执行"),s("strong",[t._v("软删除")]),t._v("。它将把版本标记为已删除，并填充一个 "),s("code",[t._v("deletion_time")]),t._v(" 时间戳。\n软删除不会从底层存储删除版本数据，这样的话，允许撤销删除版本。命令 "),s("code",[t._v("vault kv undelete")]),t._v(" 是用来处理版本的撤销删除。当使用 destroy 命令时，底层的版本数据将被删除，\nkey 元数据将被标记为已销毁。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("只有当 key 的版本数超过 "),e("code",[this._v("max-versions")]),this._v(" 设置所允许的版本数时，或者当使用 "),e("code",[this._v("vault kv destroy")]),this._v(" 时，版本的数据才会被永久删除。\n如果超过了 "),e("code",[this._v("max-versions")]),this._v(" 而清除了某个版本，那么版本元数据也将从 key 中删除。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("一个 key 的最新版本可以用 delete 命令删除，删除之前的版本需要 "),e("code",[this._v("-versions")]),this._v(" 标志:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv delete secret/my-secret\nSuccess! Data deleted (if it existed) at: secret/my-secret\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("撤销删除版本：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv undelete -versions=2 secret/my-secret\nSuccess! Data written to: secret/undelete/my-secret\n\n$ vault kv get secret/my-secret\n====== Metadata ======\nKey              Value\n---              -----\ncreated_time     2018-03-30T22:18:37.124228658Z\ndeletion_time    n/a\ndestroyed        false\nversion          2\n\n====== Data ======\nKey         Value\n---         -----\nmy-value    new-s3cr3t\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"3"}},[e("li",[this._v("销毁一个版本永久删除底层数据:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv destroy -versions=2 secret/my-secret\nSuccess! Data written to: secret/destroy/my-secret\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"key-metadata"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#key-metadata","aria-hidden":"true"}},[this._v("#")]),this._v(" Key Metadata")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("key 的所有元数据和版本都可以查看:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv metadata get secret/my-secret\n======= Metadata =======\nKey                Value\n---                -----\ncreated_time       2018-03-30T22:16:39.808909557Z\ncurrent_version    2\nmax_versions       0\noldest_version     0\nupdated_time       2018-03-30T22:18:37.124228658Z\n\n====== Version 1 ======\nKey              Value\n---              -----\ncreated_time     2018-03-30T22:16:39.808909557Z\ndeletion_time    n/a\ndestroyed        false\n\n====== Version 2 ======\nKey              Value\n---              -----\ncreated_time     2018-03-30T22:18:37.124228658Z\ndeletion_time    n/a\ndestroyed        true\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("key 的元数据设置可以配置:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv metadata put -max-versions 1 secret/my-secret\nSuccess! Data written to: secret/metadata/my-secret\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv put secret/my-secret my-value=newer-s3cr3t\nKey              Value\n---              -----\ncreated_time     2018-03-30T22:41:09.193643571Z\ndeletion_time    n/a\ndestroyed        false\nversion          3\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv metadata get secret/my-secret\n======= Metadata =======\nKey                Value\n---                -----\ncreated_time       2018-03-30T22:16:39.808909557Z\ncurrent_version    3\nmax_versions       1\noldest_version     3\nupdated_time       2018-03-30T22:41:09.193643571Z\n\n====== Version 3 ======\nKey              Value\n---              -----\ncreated_time     2018-03-30T22:41:09.193643571Z\ndeletion_time    n/a\ndestroyed        false\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"3"}},[e("li",[this._v("永久删除一个 key 的所有元数据和版本:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault kv metadata delete secret/my-secret\nSuccess! Data deleted (if it existed) at: secret/metadata/my-secret\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"pki-secrets-engine"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pki-secrets-engine","aria-hidden":"true"}},[this._v("#")]),this._v(" PKI Secrets Engine")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("PKI secrets 引擎生成动态 "),e("code",[this._v("X.509")]),this._v(" 证书。使用这个 secrets 引擎，服务可以获得证书，而不需要手动生成私钥和 CSR，提交到 CA，并等待验证和签名完成。\nVault 的内置身份验证和授权机制提供了验证功能。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"setup-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setup-3","aria-hidden":"true"}},[this._v("#")]),this._v(" Setup")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("启用 PKI secrets 引擎：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ vault secrets "),e("span",{attrs:{class:"token function"}},[this._v("enable")]),this._v(" pki\nSuccess"),e("span",{attrs:{class:"token operator"}},[this._v("!")]),this._v(" Enabled the pki secrets engine at: pki/\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("默认情况下，secrets 引擎将安装在引擎名称同名的路径上")]),this._v("。要在不同路径上启用 secrets 引擎，使用 "),e("code",[this._v("-path")]),this._v(" 参数。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"2"}},[e("li",[this._v("调整 secrets 引擎，增加 TTL。 默认值 30 天可能太短，因此将其增加到 1 年：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ vault secrets tune -max-lease-ttl"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("8760h pki\nSuccess"),e("span",{attrs:{class:"token operator"}},[this._v("!")]),this._v(" Tuned the secrets engine at: pki/\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"3"}},[e("li",[this._v("配置 CA 证书和私钥。 Vault 可以接受现有密钥对，也可以生成自己的自签名根。通常，我们建议将**根 CA **保留在 Vault 之外，并为 Vault 提供签名的中间 CA。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault "),s("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" pki/root/generate/internal \\\n    common_name"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("my-website.com \\\n    ttl"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("8760h\n\nKey              Value\n---              -----\ncertificate      -----BEGIN CERTIFICATE-----"),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nexpiration       1536807433\nissuing_ca       -----BEGIN CERTIFICATE-----"),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nserial_number    7c:f1:fb:2c:6e:4d:99:0e:82:1b:08:0a:81:ed:61:3e:1d:fa:f5:29\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"4"}},[e("li",[this._v("更新 CRL 位置并颁发证书。 这些值可以在以后更新。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault "),s("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" pki/config/urls \\\n    issuing_certificates"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"http://127.0.0.1:8200/v1/pki/ca"')]),t._v(" \\\n    crl_distribution_points"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"http://127.0.0.1:8200/v1/pki/crl"')]),t._v("\nSuccess"),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v(" Data written to: pki/config/urls\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",{attrs:{start:"5"}},[e("li",[this._v("配置一个 "),e("code",[this._v("role")]),this._v("，在 Vault 中的映射一个名字到生成证书的过程中。 当用户或计算机生成凭据时，将根据此角色生成凭据：")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault "),s("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" pki/roles/my-role \\\n    allowed_domains"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("my-website.com \\\n    allow_subdomains"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("true \\\n    max_ttl"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("72h\nSuccess"),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v(" Data written to: pki/roles/my-role\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"usage-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#usage-3","aria-hidden":"true"}},[this._v("#")]),this._v(" Usage")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("配置好 secrets 引擎并且用户或者计算机有了一个一定权限的 "),e("code",[this._v("Vault token")]),this._v("，就可以生成凭据。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("通过写入 "),e("code",[this._v("/issue")]),this._v(" 端点，并带上 "),e("code",[this._v("role name")]),this._v("，来生成新凭据：")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault "),s("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" pki/issue/my-role \\\n    common_name"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("www.my-website.com\n\nKey                 Value\n---                 -----\ncertificate         -----BEGIN CERTIFICATE-----"),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nissuing_ca          -----BEGIN CERTIFICATE-----"),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nprivate_key         -----BEGIN RSA PRIVATE KEY-----"),s("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nprivate_key_type    rsa\nserial_number       1d:2e:c6:06:45:18:60:0e:23:d6:c5:17:43:c0:fe:46:ed:d1:50:be\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("输出中会包含一个动态生成的私钥和证书，它对应了给定的 "),e("code",[this._v("role")]),this._v("，并在 72h 到期（由我们的 "),e("code",[this._v("role")]),this._v(" 定义决定）。为了简化自动化，还会返回 "),e("code",[this._v("issuing_ca")]),this._v(" 和信任链。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"considerations"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#considerations","aria-hidden":"true"}},[this._v("#")]),this._v(" Considerations")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"be-careful-with-root-cas"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#be-careful-with-root-cas","aria-hidden":"true"}},[this._v("#")]),this._v(" Be Careful with Root CAs")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Vault 存储是安全的，但不如银行保险库中的纸张安全。毕竟，这是网络软件。"),e("strong",[this._v("如果你的 "),e("code",[this._v("根 CA")]),this._v(" 托管在 Vault 之外，请不要将其放在 Vault 中;相反，发出一个寿命较短的中间 CA 证书并将\n其放入 Vault。这符合行业最佳实践")]),this._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("从 0.4 开始，secrets 引擎支持生成自签名 "),e("code",[this._v("根 CA")]),this._v(" 以及为 "),e("code",[this._v("中间 CA")]),this._v(" 创建和签署 CSR。在每个实例中，出于安全原因，私钥只能在生成时导出，并且执行此操作的能力是命令路径的\n一部分（因此可以将其放入 ACL 策略中）。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果你计划将 "),e("code",[this._v("中间 CA")]),this._v(" 与 Vault 一起使用，建议让 Vault 创建 CSR 并且不导出私钥，然后使用 "),e("code",[this._v("根CA")]),this._v("（可能是 pki secrets 引擎的第二个挂载）对其进行签名。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"one-ca-certificate-one-secrets-engine"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#one-ca-certificate-one-secrets-engine","aria-hidden":"true"}},[this._v("#")]),this._v(" One CA Certificate, One Secrets Engine")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("常见模式是将一个安装程序用作 "),e("code",[this._v("根 CA")]),this._v("，并仅使用此 CA 从其他 PKI secrets 引擎签署中间 CA CSR。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"keep-certificate-lifetimes-short-for-crl-s-sake"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#keep-certificate-lifetimes-short-for-crl-s-sake","aria-hidden":"true"}},[this._v("#")]),this._v(" Keep certificate lifetimes short, for CRL's sake")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"you-must-configure-issuing-crl-ocsp-information-in-advance"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#you-must-configure-issuing-crl-ocsp-information-in-advance","aria-hidden":"true"}},[this._v("#")]),this._v(" You must configure issuing/CRL/OCSP information in advance")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("这个 secrets 引擎从可预测的位置提供 CRL，但 secrets 引擎不可能知道它在哪里运行。因此，必须使用 "),e("code",[this._v("config/urls")]),this._v(" 端点手动为颁发证书，CRL 分发点和 OCSP 服务器配置所需的 URL。\n通过将多个URL作为逗号分隔的字符串参数传递，支持它们中的每一个都有多个。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"safe-minimums"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#safe-minimums","aria-hidden":"true"}},[this._v("#")]),this._v(" Safe Minimums")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"token-lifetimes-and-revocation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#token-lifetimes-and-revocation","aria-hidden":"true"}},[this._v("#")]),this._v(" Token Lifetimes and Revocation")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("当令牌到期时，它会撤销与之关联的所有租约。 这意味着长期使用的 CA 证书需要相应的长期令牌，这很容易被遗忘。 从 0.6 开始，"),e("code",[this._v("根 CA")]),this._v(" 和 "),e("code",[this._v("中间 CA")]),this._v(" 证书不再具有关联租约，\n以防止在不使用具有足够长寿命的令牌时意外撤销。要撤消这些证书，使用 "),e("code",[this._v("pki/revoke")]),this._v(" 端点。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"quick-start"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#quick-start","aria-hidden":"true"}},[this._v("#")]),this._v(" Quick Start")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"mount-the-backend"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mount-the-backend","aria-hidden":"true"}},[this._v("#")]),this._v(" Mount the backend")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("使用 "),e("code",[this._v("pki")]),this._v(" 后端的第一步是挂载它。 与 "),e("code",[this._v("kv")]),this._v(" 后端不同，默认情况下不会安装 "),e("code",[this._v("pki")]),this._v(" 后端。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault secrets "),s("span",{attrs:{class:"token function"}},[t._v("enable")]),t._v(" pki\nSuccessfully mounted "),s("span",{attrs:{class:"token string"}},[t._v("'pki'")]),t._v(" at "),s("span",{attrs:{class:"token string"}},[t._v("'pki'")]),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"configure-a-ca-certificate"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configure-a-ca-certificate","aria-hidden":"true"}},[this._v("#")]),this._v(" Configure a CA certificate")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("下一步，必须使用 CA 证书和关联的私钥配置 Vault。 我们将利用后端的自签名根生成支持，但 Vault 还支持生成 "),e("code",[this._v("中间 CA")]),this._v("（使用CSR进行签名）或将 PEM 编码的证书和私钥包直接设\n置到后端。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault secrets tune -max-lease-ttl"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("87600h pki\nSuccessfully tuned "),s("span",{attrs:{class:"token function"}},[t._v("mount")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'pki'")]),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("这里设置 secrets 的从挂载发出后的最大 TTL 为 10 年。 （请注意，"),e("code",[this._v("role")]),this._v(" 可以进一步限制最大 TTL。）")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ vault "),e("span",{attrs:{class:"token function"}},[this._v("write")]),this._v(" pki/root/generate/internal common_name"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("myvault.com ttl"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("87600h\nKey             Value\n---             -----\ncertificate     -----BEGIN CERTIFICATE-----\nMIIDNTCCAh2gAwIBAgIUJqrw/9EDZbp4DExaLjh0vSAHyBgwDQYJKoZIhvcNAQEL\nBQAwFjEUMBIGA1UEAxMLbXl2YXVsdC5jb20wHhcNMTcxMjA4MTkyMzIwWhcNMjcx\nMjA2MTkyMzQ5WjAWMRQwEgYDVQQDEwtteXZhdWx0LmNvbTCCASIwDQYJKoZIhvcN\nAQEBBQADggEPADCCAQoCggEBAKY/vJ6sRFym+yFYUneoVtDmOCaDKAQiGzQw0IXL\nwgMBBb82iKpYj5aQjXZGIl+VkVnCi+M2AQ/iYXWZf1kTAdle4A6OC4+VefSIa2b4\neB7R8aiGTce62jB95+s5/YgrfIqk6igfpCSXYLE8ubNDA2/+cqvjhku1UzlvKBX2\nhIlgWkKlrsnybHN+B/3Usw9Km/87rzoDR3OMxLV55YPHiq6+olIfSSwKAPjH8LZm\nuM1ITLG3WQUl8ARF17Dj+wOKqbUG38PduVwKL5+qPksrvNwlmCP7Kmjncc6xnYp6\n5lfr7V4DC/UezrJYCIb0g/SvtxoN1OuqmmvSTKiEE7hVOAcCAwEAAaN7MHkwDgYD\nVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFECKdYM4gDbM\nkxRZA2wR4f/yNhQUMB8GA1UdIwQYMBaAFECKdYM4gDbMkxRZA2wR4f/yNhQUMBYG\nA1UdEQQPMA2CC215dmF1bHQuY29tMA0GCSqGSIb3DQEBCwUAA4IBAQCCJKZPcjjn\n7mvD2+sr6lx4DW/vJwVSW8eTuLtOLNu6/aFhcgTY/OOB8q4n6iHuLrEt8/RV7RJI\nobRx74SfK9BcOLt4+DHGnFXqu2FNVnhDMOKarj41yGyXlJaQRUPYf6WJJLF+ZphN\nnNsZqHJHBfZtpJpE5Vywx3pah08B5yZHk1ItRPEz7EY3uwBI/CJoBb+P5Ahk6krc\nLZ62kFwstkVuFp43o3K7cRNexCIsZGx2tsyZ0nyqDUFsBr66xwUfn3C+/1CDc9YL\nzjq+8nI2ooIrj4ZKZCOm2fKd1KeGN/CZD7Ob6uNhXrd0Tjwv00a7nffvYQkl/1V5\nBT55jevSPVVu\n-----END CERTIFICATE-----\nexpiration      1828121029\nissuing_ca      -----BEGIN CERTIFICATE-----\nMIIDNTCCAh2gAwIBAgIUJqrw/9EDZbp4DExaLjh0vSAHyBgwDQYJKoZIhvcNAQEL\nBQAwFjEUMBIGA1UEAxMLbXl2YXVsdC5jb20wHhcNMTcxMjA4MTkyMzIwWhcNMjcx\nMjA2MTkyMzQ5WjAWMRQwEgYDVQQDEwtteXZhdWx0LmNvbTCCASIwDQYJKoZIhvcN\nAQEBBQADggEPADCCAQoCggEBAKY/vJ6sRFym+yFYUneoVtDmOCaDKAQiGzQw0IXL\nwgMBBb82iKpYj5aQjXZGIl+VkVnCi+M2AQ/iYXWZf1kTAdle4A6OC4+VefSIa2b4\neB7R8aiGTce62jB95+s5/YgrfIqk6igfpCSXYLE8ubNDA2/+cqvjhku1UzlvKBX2\nhIlgWkKlrsnybHN+B/3Usw9Km/87rzoDR3OMxLV55YPHiq6+olIfSSwKAPjH8LZm\nuM1ITLG3WQUl8ARF17Dj+wOKqbUG38PduVwKL5+qPksrvNwlmCP7Kmjncc6xnYp6\n5lfr7V4DC/UezrJYCIb0g/SvtxoN1OuqmmvSTKiEE7hVOAcCAwEAAaN7MHkwDgYD\nVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFECKdYM4gDbM\nkxRZA2wR4f/yNhQUMB8GA1UdIwQYMBaAFECKdYM4gDbMkxRZA2wR4f/yNhQUMBYG\nA1UdEQQPMA2CC215dmF1bHQuY29tMA0GCSqGSIb3DQEBCwUAA4IBAQCCJKZPcjjn\n7mvD2+sr6lx4DW/vJwVSW8eTuLtOLNu6/aFhcgTY/OOB8q4n6iHuLrEt8/RV7RJI\nobRx74SfK9BcOLt4+DHGnFXqu2FNVnhDMOKarj41yGyXlJaQRUPYf6WJJLF+ZphN\nnNsZqHJHBfZtpJpE5Vywx3pah08B5yZHk1ItRPEz7EY3uwBI/CJoBb+P5Ahk6krc\nLZ62kFwstkVuFp43o3K7cRNexCIsZGx2tsyZ0nyqDUFsBr66xwUfn3C+/1CDc9YL\nzjq+8nI2ooIrj4ZKZCOm2fKd1KeGN/CZD7Ob6uNhXrd0Tjwv00a7nffvYQkl/1V5\nBT55jevSPVVu\n-----END CERTIFICATE-----\nserial_number   26:aa:f0:ff:d1:03:65:ba:78:0c:4c:5a:2e:38:74:bd:20:07:c8:18\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"set-url-configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#set-url-configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Set URL configuration")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault "),s("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" pki/config/urls issuing_certificates"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"http://vault.example.com:8200/v1/pki/ca"')]),t._v(" crl_distribution_points"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"http://vault.example.com:8200/v1/pki/crl"')]),t._v("\nSuccess"),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v(" Data written to: pki/ca/urls\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"configure-a-role"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configure-a-role","aria-hidden":"true"}},[this._v("#")]),this._v(" Configure a role")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("下一步是配置 "),e("code",[this._v("role")]),this._v("。 "),e("code",[this._v("role")]),this._v(" 是映射到用于生成这些凭据的策略的逻辑名称。 例如，我们创建一个 “example-dot-com” 的 "),e("code",[this._v("role")]),this._v("：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault "),s("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" pki/roles/example-dot-com \\\n    allowed_domains"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("example.com \\\n    allow_subdomains"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("true max_ttl"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("72h\nSuccess"),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v(" Data written to: pki/roles/example-dot-com\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"issue-certificates"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#issue-certificates","aria-hidden":"true"}},[this._v("#")]),this._v(" Issue Certificates")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("通过写入 "),s("code",[t._v("roles/example-dot-com")]),t._v(" 路径，我们定义了 "),s("code",[t._v("example-dot-com")]),t._v(" 角色。要生成新证书，我们只需使用该 "),s("code",[t._v("role")]),t._v(" 名称写入 "),s("code",[t._v("issue")]),t._v(" 端点：Vault 现已配置好，可以创建和管理证书。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ vault "),e("span",{attrs:{class:"token function"}},[this._v("write")]),this._v(" pki/issue/example-dot-com \\\n    common_name"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("blah.example.com\nKey                 Value\n---                 -----\ncertificate         -----BEGIN CERTIFICATE-----\nMIIDvzCCAqegAwIBAgIUWQuvpMpA2ym36EoiYyf3Os5UeIowDQYJKoZIhvcNAQEL\nBQAwFjEUMBIGA1UEAxMLbXl2YXVsdC5jb20wHhcNMTcxMjA4MTkyNDA1WhcNMTcx\nMjExMTkyNDM1WjAbMRkwFwYDVQQDExBibGFoLmV4YW1wbGUuY29tMIIBIjANBgkq\nhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1CU93lVgcLXGPxRGTRT3GM5wqytCo7Z6\ngjfoHyKoPCAqjRdjsYgp1FMvumNQKjUat5KTtr2fypbOnAURDCh4bN/omcj7eAqt\nldJ8mf8CtKUaaJ1kp3R6RRFY/u96BnmKUG8G7oDeEDsKlXuEuRcNbGlGF8DaM/O1\nHFa57cM/8yFB26Nj5wBoG5Om6ee5+W+14Qee8AB6OJbsf883Z+zvhJTaB0QM4ZUq\nuAMoMVEutWhdI5EFm5OjtMeMu2U+iJl2XqqgQ/JmLRjRdMn1qd9TzTaVSnjoZ97s\njHK444Px1m45einLqKUJ+Ia2ljXYkkItJj9Ut6ZSAP9fHlAtX84W3QIDAQABo4H/\nMIH8MA4GA1UdDwEB/wQEAwIDqDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUH\nAwIwHQYDVR0OBBYEFH/YdObW6T94U0zuU5hBfTfU5pt1MB8GA1UdIwQYMBaAFECK\ndYM4gDbMkxRZA2wR4f/yNhQUMDsGCCsGAQUFBwEBBC8wLTArBggrBgEFBQcwAoYf\naHR0cDovLzEyNy4wLjAuMTo4MjAwL3YxL3BraS9jYTAbBgNVHREEFDASghBibGFo\nLmV4YW1wbGUuY29tMDEGA1UdHwQqMCgwJqAkoCKGIGh0dHA6Ly8xMjcuMC4wLjE6\nODIwMC92MS9wa2kvY3JsMA0GCSqGSIb3DQEBCwUAA4IBAQCDXbHV68VayweB2tkb\nKDdCaveaTULjCeJUnm9UT/6C0YqC/RxTAjdKFrilK49elOA3rAtEL6dmsDP2yH25\nptqi2iU+y99HhZgu0zkS/p8elYN3+l+0O7pOxayYXBkFf5t0TlEWSTb7cW+Etz/c\nMvSqx6vVvspSjB0PsA3eBq0caZnUJv2u/TEiUe7PPY0UmrZxp/R/P/kE54yI3nWN\n4Cwto6yUwScOPbVR1d3hE2KU2toiVkEoOk17UyXWTokbG8rG0KLj99zu7my+Fyre\nsjV5nWGDSMZODEsGxHOC+JgNAC1z3n14/InFNOsHICnA5AnJzQdSQQjvcZHN2NyW\n+t4f\n-----END CERTIFICATE-----\nissuing_ca          -----BEGIN CERTIFICATE-----\nMIIDNTCCAh2gAwIBAgIUJqrw/9EDZbp4DExaLjh0vSAHyBgwDQYJKoZIhvcNAQEL\nBQAwFjEUMBIGA1UEAxMLbXl2YXVsdC5jb20wHhcNMTcxMjA4MTkyMzIwWhcNMjcx\nMjA2MTkyMzQ5WjAWMRQwEgYDVQQDEwtteXZhdWx0LmNvbTCCASIwDQYJKoZIhvcN\nAQEBBQADggEPADCCAQoCggEBAKY/vJ6sRFym+yFYUneoVtDmOCaDKAQiGzQw0IXL\nwgMBBb82iKpYj5aQjXZGIl+VkVnCi+M2AQ/iYXWZf1kTAdle4A6OC4+VefSIa2b4\neB7R8aiGTce62jB95+s5/YgrfIqk6igfpCSXYLE8ubNDA2/+cqvjhku1UzlvKBX2\nhIlgWkKlrsnybHN+B/3Usw9Km/87rzoDR3OMxLV55YPHiq6+olIfSSwKAPjH8LZm\nuM1ITLG3WQUl8ARF17Dj+wOKqbUG38PduVwKL5+qPksrvNwlmCP7Kmjncc6xnYp6\n5lfr7V4DC/UezrJYCIb0g/SvtxoN1OuqmmvSTKiEE7hVOAcCAwEAAaN7MHkwDgYD\nVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFECKdYM4gDbM\nkxRZA2wR4f/yNhQUMB8GA1UdIwQYMBaAFECKdYM4gDbMkxRZA2wR4f/yNhQUMBYG\nA1UdEQQPMA2CC215dmF1bHQuY29tMA0GCSqGSIb3DQEBCwUAA4IBAQCCJKZPcjjn\n7mvD2+sr6lx4DW/vJwVSW8eTuLtOLNu6/aFhcgTY/OOB8q4n6iHuLrEt8/RV7RJI\nobRx74SfK9BcOLt4+DHGnFXqu2FNVnhDMOKarj41yGyXlJaQRUPYf6WJJLF+ZphN\nnNsZqHJHBfZtpJpE5Vywx3pah08B5yZHk1ItRPEz7EY3uwBI/CJoBb+P5Ahk6krc\nLZ62kFwstkVuFp43o3K7cRNexCIsZGx2tsyZ0nyqDUFsBr66xwUfn3C+/1CDc9YL\nzjq+8nI2ooIrj4ZKZCOm2fKd1KeGN/CZD7Ob6uNhXrd0Tjwv00a7nffvYQkl/1V5\nBT55jevSPVVu\n-----END CERTIFICATE-----\nprivate_key         -----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEA1CU93lVgcLXGPxRGTRT3GM5wqytCo7Z6gjfoHyKoPCAqjRdj\nsYgp1FMvumNQKjUat5KTtr2fypbOnAURDCh4bN/omcj7eAqtldJ8mf8CtKUaaJ1k\np3R6RRFY/u96BnmKUG8G7oDeEDsKlXuEuRcNbGlGF8DaM/O1HFa57cM/8yFB26Nj\n5wBoG5Om6ee5+W+14Qee8AB6OJbsf883Z+zvhJTaB0QM4ZUquAMoMVEutWhdI5EF\nm5OjtMeMu2U+iJl2XqqgQ/JmLRjRdMn1qd9TzTaVSnjoZ97sjHK444Px1m45einL\nqKUJ+Ia2ljXYkkItJj9Ut6ZSAP9fHlAtX84W3QIDAQABAoIBAQCf5YIANfF+gkNt\n/+YM6yRi+hZJrU2I/1zPETxPW1vaFZR8y4hEoxCEDD8JCRm+9k+w1TWoorvxgkEv\nr1HuDALYbNtwLd/71nCHYCKyH1b2uQpyl07qOAyASlb9r5oVjz4E6eobkd3N9fJA\nQN0EdK+VarN968mLJsD3Hxb8chGdObBCQ+LO+zdqQLaz+JwhfnK98rm6huQtYK3w\nccd0OwoVmtZz2eJl11TJkB9fi4WqJyxl4wST7QC80LstB1deR78oDmN5WUKU12+G\n4Mrgc1hRwUSm18HTTgAhaA4A3rjPyirBohb5Sf+jJxusnnay7tvWeMnIiRI9mqCE\ndr3tLrcxAoGBAPL+jHVUF6sxBqm6RTe8Ewg/8RrGmd69oB71QlVUrLYyC96E2s56\n19dcyt5U2z+F0u9wlwR1rMb2BJIXbxlNk+i87IHmpOjCMS38SPZYWLHKj02eGfvA\nMjKKqEjNY/md9eVAVZIWSEy63c4UcBK1qUH3/5PNlyjk53gCOI/4OXX/AoGBAN+A\nAlyd6A/pyHWq8WMyAlV18LnzX8XktJ07xrNmjbPGD5sEHp+Q9V33NitOZpu3bQL+\ngCNmcrodrbr9LBV83bkAOVJrf82SPaBesV+ATY7ZiWpqvHTmcoS7nglM2XTr+uWR\nY9JGdpCE9U5QwTc6qfcn7Eqj7yNvvHMrT+1SHwsjAoGBALQyQEbhzYuOF7rV/26N\nci+z+0A39vNO++b5Se+tk0apZlPlgb2NK3LxxR+LHevFed9GRzdvbGk/F7Se3CyP\ncxgswdazC6fwGjhX1mOYsG1oIU0V6X7f0FnaqWETrwf1M9yGEO78xzDfgozIazP0\ns0fQeR9KXsZcuaotO3TIRxRRAoGAMFIDsLRvDKm1rkL0B0czm/hwwDMu/KDyr5/R\n2M2OS1TB4PjmCgeUFOmyq3A63OWuStxtJboribOK8Qd1dXvWj/3NZtVY/z/j1P1E\nCeq6We0MOZa0Ae4kyi+p/kbAKPgv+VwSoc6cKailRHZPH7quLoJSIt0IgbfRnXC6\nygtcLNMCgYBwiPw2mTYvXDrAcO17NhK/r7IL7BEdFdx/w8vNJQp+Ub4OO3Iw6ARI\nvXxu6A+Qp50jra3UUtnI+hIirMS+XEeWqJghK1js3ZR6wA/ZkYZw5X1RYuPexb/4\n6befxmnEuGSbsgvGqYYTf5Z0vgsw4tAHfNS7TqSulYH06CjeG1F8DQ"),e("span",{attrs:{class:"token operator"}},[this._v("==")]),this._v("\n-----END RSA PRIVATE KEY-----\nprivate_key_type    rsa\nserial_number       59:0b:af:a4:ca:40:db:29:b7:e8:4a:22:63:27:f7:3a:ce:54:78:8a\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Vault 现在使用 "),e("code",[this._v("example-dot-com")]),this._v(" 角色配置生成一组新凭据。在这里，我们看到动态生成的私钥和证书。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("使用 ACL，可以限制使用 "),e("code",[this._v("pki")]),this._v(" 后端，以便可信操作者可以管理角色定义，并且用户和应用程序都受限于这个凭据，仅允许读取。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果在任何时候遇到困难，只需运行 "),e("code",[this._v("vault path-help pki")]),this._v(" 或使用子路径输出帮助。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"setting-up-intermediate-ca"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-intermediate-ca","aria-hidden":"true"}},[this._v("#")]),this._v(" Setting Up Intermediate CA")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"mount-the-backend-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mount-the-backend-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Mount the backend")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault secrets "),s("span",{attrs:{class:"token function"}},[t._v("enable")]),t._v(" -path"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("pki_int pki\nSuccessfully mounted "),s("span",{attrs:{class:"token string"}},[t._v("'pki'")]),t._v(" at "),s("span",{attrs:{class:"token string"}},[t._v("'pki_int'")]),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"configure-an-intermediate-ca"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configure-an-intermediate-ca","aria-hidden":"true"}},[this._v("#")]),this._v(" Configure an Intermediate CA")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault secrets tune -max-lease-ttl"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("43800h pki_int\nSuccessfully tuned "),s("span",{attrs:{class:"token function"}},[t._v("mount")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'pki_int'")]),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault "),s("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" pki_int/intermediate/generate/internal common_name"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"myvault.com Intermediate Authority"')]),t._v(" ttl"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("43800h\nKey Value\ncsr -----BEGIN CERTIFICATE REQUEST-----\nMIICsjCCAZoCAQAwLTErMCkGA1UEAxMibXl2YXVsdC5jb20gSW50ZXJtZWRpYXRl\nIEF1dGhvcml0eTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJU1Qh8l\nBW16WHAu34Fy92FnSy4219WVlKw1xwpKxjd95xH6WcxXozOs6oHFQ9c592bz51F8\nKK3FFJYraUrGONI5Cz9qHbzC1mFCmjnXVXCoeNKIzEBG0Y+ehH7MQ1SvDCyvaJPX\nItFXaGf6zENiGsApw3Y3lFr0MjPzZDBH1p4Nq3aA6L2BaxvO5vczdQl5tE2ud/zs\nGIdCWnl1ThDEeiX1Ppduos/dx3gaZa9ly3iCuDMKIL9yK5XTBTgKB6ALPApekLQB\nkcUFbOuMzjrDSBe9ytu65yICYp26iAPPA8aKTj5cUgscgzEvQS66rSAVG/unrWxb\nwbl8b7eQztCmp60CAwEAAaBAMD4GCSqGSIb3DQEJDjExMC8wLQYDVR0RBCYwJIIi\nbXl2YXVsdC5jb20gSW50ZXJtZWRpYXRlIEF1dGhvcml0eTANBgkqhkiG9w0BAQsF\nAAOCAQEAZA9A1QvTdAd45+Ay55FmKNWnis1zLjbmWNJURUoDei6i6SCJg0YGX1cZ\nWkD0ibxPYihSsKRaIUwC2bE8cxZM57OSs7ISUmyPQAT2IHTHvuGK72qlFRBlFOzg\nSHEG7gfyKdrALphyF8wM3u4gXhcnY3CdltjabL3YakZqd3Ey4870/0XXeo5c4k7w\n/+n9M4xED4TnXYCGfLAlu5WWKSeCvu9mHXnJcLo1MiYjX7KGey/xYYbfxHSPm4ul\ntI6Vf59zDRscfNmq37fERD3TiKP0QZNGTSRvnrxrx2RUQGXFywM8l4doG8nS5BxU\n2jP20cdv0lJFvHr9663/8B/+F5L6Yw"),s("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v("\n-----END CERTIFICATE REQUEST-----\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault "),s("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" pki/root/sign-intermediate csr"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("@pki_int.csr format"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("pem_bundle ttl"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("43800h\nKey             Value\ncertificate     -----BEGIN CERTIFICATE-----\nMIIDZTCCAk2gAwIBAgIUENxQD7KIJi1zE/jEiYqAG1VC4NwwDQYJKoZIhvcNAQEL\nBQAwFjEUMBIGA1UEAxMLbXl2YXVsdC5jb20wHhcNMTcxMTI4MTcwNzIzWhcNMjIx\nMTI3MTcwNzUzWjAtMSswKQYDVQQDEyJteXZhdWx0LmNvbSBJbnRlcm1lZGlhdGUg\nQXV0aG9yaXR5MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5seNV4Yd\nuCMX0POUUuSzCBiR3Cyf9b9tGsCX7UfvZmjPs+Fl/X+Ovq6UtHM9RuTGlyfFrCWy\npflO7mc0H8PBzlvhv1WQet5aRyUOXkG6iYmooG9iobIY8z/TZCaCF605pgygfOaS\nDIlwOdJkfiXxGpQ00pfIwe/Y2OK2I5e36u0E2EA6kXvcfexLjQGFPbod+H0R29Ro\n/GwOJ6MpSHqB77mF025x1y08EtqT1z1kFCiDzFSkzNZEZYWljhDS6ZRY9ctzKufm\n5CkUwmvCVRI2CivDJvmfhXyv0DRoq4IhYdJHo179RSObq3BY9f9LQ0balNLiM0Ft\nO8f0urTqUAbySwIDAQABo4GTMIGQMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8E\nBTADAQH/MB0GA1UdDgQWBBSQgTfcMrKYzyckP6t/0iVQkl0ZBDAfBgNVHSMEGDAW\ngBRccsCARqs3wQDjW7JMNXS6pWlFSDAtBgNVHREEJjAkgiJteXZhdWx0LmNvbSBJ\nbnRlcm1lZGlhdGUgQXV0aG9yaXR5MA0GCSqGSIb3DQEBCwUAA4IBAQABNg2HxccY\nDwRpsJ+sxA0BgDyF+tYtOlXViVNv6Z+nOU0nNhQSCjfzjYWmBg25nfKaFhQSC3b7\nfIW+e7it/FLVrCgaqdysoxljqhR0gXMAy8S/ubmskPWjJiKauJB5bfB59Uf2GP6j\nzimZDu6WjWvvgkKcJqJEbOOS9DWBvCTdmmml1NMXZtcytpod2Y7mxninqNRx3qpx\nPst4vgAbyM/3zLSzkyUD+MXIyRXwxktFlyEYBHvMd9OoHzLO6WLxk22FyQQ+w4by\nNfXJY4r5pj6a4lJ6pPuqyfBhidYMTdY3AI7w/QRGk4qQv1iDmnZspk2AxdbR5Lwe\nYmChIML/f++S\n-----END CERTIFICATE-----\nexpiration      1669568873\nissuing_ca      -----BEGIN CERTIFICATE-----\nMIIDNTCCAh2gAwIBAgIUdR44qhhyh3CZjnCtflGKQlTI8NswDQYJKoZIhvcNAQEL\nBQAwFjEUMBIGA1UEAxMLbXl2YXVsdC5jb20wHhcNMTcxMTI4MTYxODA2WhcNMjcx\nMTI2MTYxODM1WjAWMRQwEgYDVQQDEwtteXZhdWx0LmNvbTCCASIwDQYJKoZIhvcN\nAQEBBQADggEPADCCAQoCggEBANTPnQ2CUkuLrYT4V6/IIK/gWFZXFG4lWTmgM5Zh\nPDquMhLEikZCbZKbupouBI8MOr5i8tycENaTnSs9dBwVEOWAHbLkliVgvCKgLi0F\nPfPM87FnBoKVctO2ip8AdmYcAt/wc096dWBG6eKLVP5xsAe7NcYDtF/inHgEZ22q\nZjGVEyC6WntIASgULoHGgHakPp1AHLhGm8nL5YbusWY7RgZIlNeGWLVoneG0pxdV\n7W1SPO67dsQyq58mTxMIGVUj5YE1q7/C6OhCTnAHc+sRm0oUehPfO8kY4NHpCJGv\nnDRdJi6k6ewk94c0KK2tUUM/TN6ZSRfx6ccgfPH8zNcVPVcCAwEAAaN7MHkwDgYD\nVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFFxywIBGqzfB\nAONbskw1dLqlaUVIMB8GA1UdIwQYMBaAFFxywIBGqzfBAONbskw1dLqlaUVIMBYG\nA1UdEQQPMA2CC215dmF1bHQuY29tMA0GCSqGSIb3DQEBCwUAA4IBAQBgvsgpBuVR\niKVdXXpFyoQLImuoaHZgaj5tuUDqnMoxOA1XWW6SVlZmGfDQ7+u5NBkp2cGSDRGm\nARHJTeURvdZIwdFdGkNqfAZjutRjjQOnXgS65ujZd7AnlZq1v0ZOZqVVk9YEOhOe\nRh2MjnHGNuiLBib1YNQHNuRef1mPwIE2Gm/Tz/z3JPHtkKNIKbn60zHrIIM/OT2Z\nHYjcMUcqXtKGYfNjVspJm3lSDUoyJdaq80Afmy2Ez1Vt9crGG3Dj8mgs59lEhEyo\nMDVhOP116M5HJfQlRPVd29qS8pFrjBvXKjJSnJNG1UFdrWBJRJ3QrBxUQALKrJlR\ng5lvTeymHjS/\n-----END CERTIFICATE-----\nserial_number   10:dc:50:0f:b2:88:26:2d:73:13:f8:c4:89:8a:80:1b:55:42:e0:dc\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("$ vault "),e("span",{attrs:{class:"token function"}},[this._v("write")]),this._v(" pki_int/intermediate/set-signed certificate"),e("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("@signed_certificate.pem\nSuccess"),e("span",{attrs:{class:"token operator"}},[this._v("!")]),this._v(" Data written to: pki_int/intermediate/set-signed\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"set-url-configuration-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#set-url-configuration-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Set URL configuration")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault "),s("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" pki_int/config/urls issuing_certificates"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"http://127.0.0.1:8200/v1/pki_int/ca"')]),t._v(" crl_distribution_points"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"http://127.0.0.1:8200/v1/pki_int/crl"')]),t._v("\nSuccess"),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v(" Data written to: pki_int/ca/urls\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"configure-a-role-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configure-a-role-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Configure a role")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("下一步是配置 "),e("code",[this._v("role")]),this._v("。 "),e("code",[this._v("role")]),this._v(" 是映射到用于生成这些凭据的策略的逻辑名称。 例如，我们创建一个 “example-dot-com” 的 "),e("code",[this._v("role")]),this._v("：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault "),s("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" pki_int/roles/example-dot-com \\\n    allowed_domains"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("example.com \\\n    allow_subdomains"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("true max_ttl"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("72h\nSuccess"),s("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v(" Data written to: pki_int/roles/example-dot-com\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"issue-certificates-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#issue-certificates-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Issue Certificates")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("通过写入 "),s("code",[t._v("roles/example-dot-com")]),t._v(" 路径，我们定义了 "),s("code",[t._v("example-dot-com")]),t._v(" 角色。 要生成新证书，我们只需使用该 "),s("code",[t._v("role")]),t._v(" 名称写入 "),s("code",[t._v("issue")]),t._v(" 端点：Vault 现已配置好，可以创建和管理证书。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ vault "),s("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" pki_int/issue/example-dot-com \\\n    common_name"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("blah.example.com\nKey                 Value\n---                 -----\ncertificate         -----BEGIN CERTIFICATE-----\nMIIDbDCCAlSgAwIBAgIUPiAyxq+nIE6xlWf7hrzLkPQxtvMwDQYJKoZIhvcNAQEL\nBQAwMzExMC8GA1UEAxMoVmF1bHQgVGVzdGluZyBJbnRlcm1lZGlhdGUgU3ViIEF1\ndGhvcml0eTAeFw0xNjA5MjcwMDA5MTNaFw0xNjA5MjcwMTA5NDNaMBsxGTAXBgNV\nBAMTEGJsYWguZXhhbXBsZS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK\nAoIBAQDJAYB04IVdmSC/TimaA6BbXlvgBTZHL5wBUTmO4iHhenL0eDEXVe2Fd7Yq\n75LiBJmcC96hKbqh5rwS8KwN9ElZI52/mSMC+IvoNlYHAf7shwfsjrVx3q7/bTFg\nlz6wECn1ugysxynmMvgQD/pliRkxTQ7RMh4Qlh75YG3R9BHy9ZddklZp0aNaitts\n0uufHnN1UER/wxBCZdWTUu34KDL9I6yE7Br0slKKHPdEsGlFcMkbZhvjslZ7DGvO\n974S0qtOdKiawJZbpNPg0foGZ3AxesDUlkHmmgzUNes/sjknDYTHEfeXM6Uap0j6\nXvyhCxqdeahb/Vtibg0z9I0IusJbAgMBAAGjgY8wgYwwDgYDVR0PAQH/BAQDAgOo\nMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAdBgNVHQ4EFgQU/5oy0rL7\nTT0wX7KZK7qcXqgayNwwHwYDVR0jBBgwFoAUgM37P8oXmA972ztLfw+b1eIY5now\nGwYDVR0RBBQwEoIQYmxhaC5leGFtcGxlLmNvbTANBgkqhkiG9w0BAQsFAAOCAQEA\nCT2vI6/taeLTw6ZulUhLXEXYXWZu1gF8n2COjZzbZXmHxQAoZ3GtnSNwacPHAyIj\nf3cA9Moo552y39LUtWk+wgFtQokWGK7LXglLaveNUBowOHq/xk0waiIinJcgTG53\nZ/qnbJnTjAOG7JwVJplWUIiS1avCksrHt7heE2EGRGJALqyLZ119+PW6ogtCLUv1\nX8RCTw/UkIF/LT+sLF0bXWy4Hn38Gjwj1MVv1l76cEGOVSHyrYkN+6AMnAP58L5+\nIWE9tN3oac4x7jhbuNpfxazIJ8Q6l/Up5U5Evfbh6N1DI0/gFCP20fMBkHwkuLfZ\n2ekZoSeCgFRDlHGkr7Vv9w"),s("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v("\n-----END CERTIFICATE-----\nissuing_ca          -----BEGIN CERTIFICATE-----\nMIIDijCCAnKgAwIBAgIUB28DoGwgGFKL7fbOu9S4FalHLn0wDQYJKoZIhvcNAQEL\nBQAwLzEtMCsGA1UEAxMkVmF1bHQgVGVzdGluZyBJbnRlcm1lZGlhdGUgQXV0aG9y\naXR5MB4XDTE2MDkyNzAwMDgyMVoXDTI2MDkxNjE2MDg1MVowMzExMC8GA1UEAxMo\nVmF1bHQgVGVzdGluZyBJbnRlcm1lZGlhdGUgU3ViIEF1dGhvcml0eTCCASIwDQYJ\nKoZIhvcNAQEBBQADggEPADCCAQoCggEBAOSCiSij4wy1wiMwvZt+rtU3IaO6ZTn9\nLfIPuGsR5/QSJk37pCZQco1LgoE/rTl+/xu3bDovyHDmgObghC6rzVOX2Tpi7kD+\nDOZpqxOsaS8ebYgxB/XJTSxyEJuSAcpSNLqqAiZivuQXdaD0N7H3Or0awwmKE9mD\nI0g8CF4fPDmuuOG0ASn9fMqXVVt5tXtEqZ9yJYfNOXx3FOPjRVOZf+kvSc31wCKe\ni/KmR0AQOmToKMzq988nLqFPTi9KZB8sEU20cGFeTQFol+m3FTcIru94EPD+nLUn\nxtlLELVspYb/PP3VpvRj9b+DY8FGJ5nfSJl7Rkje+CD4VxJpSadin3kCAwEAAaOB\nmTCBljAOBgNVHQ8BAf8EBAMCAQYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQU\ngM37P8oXmA972ztLfw+b1eIY5nowHwYDVR0jBBgwFoAUj4YAIxRwrBy0QMRKLnD0\nkVidIuYwMwYDVR0RBCwwKoIoVmF1bHQgVGVzdGluZyBJbnRlcm1lZGlhdGUgU3Vi\nIEF1dGhvcml0eTANBgkqhkiG9w0BAQsFAAOCAQEAA4buJuPNJvA1kiATLw1dVU2J\nHPubk2Kp26Mg+GwLn7Vz45Ub133JCYfF3/zXLFZZ5Yub9gWTtjScrvNfQTAbNGdQ\nBdnUlMmIRmfB7bfckhryR2R9byumeHATgNKZF7h8liNHI7X8tTzZGs6wPdXOLlzR\nTlM3m1RNK8pbSPOkfPb06w9cBRlD8OAbNtJmuypXA6tYyiiMYBhP0QLAO3i4m1ns\naAjAgEjtkB1rQxW5DxoTArZ0asiIdmIcIGmsVxfDQIjFlRxAkafMs74v+5U5gbBX\nwsOledU0fLl8KLq8W3OXqJwhGLK65fscrP0/omPAcFgzXf+L4VUADM4XhW6Xyg"),s("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v("\n-----END CERTIFICATE-----\nca_chain            "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-----BEGIN CERTIFICATE-----\nMIIDijCCAnKgAwIBAgIUB28DoGwgGFKL7fbOu9S4FalHLn0wDQYJKoZIhvcNAQEL\nBQAwLzEtMCsGA1UEAxMkVmF1bHQgVGVzdGluZyBJbnRlcm1lZGlhdGUgQXV0aG9y\naXR5MB4XDTE2MDkyNzAwMDgyMVoXDTI2MDkxNjE2MDg1MVowMzExMC8GA1UEAxMo\nVmF1bHQgVGVzdGluZyBJbnRlcm1lZGlhdGUgU3ViIEF1dGhvcml0eTCCASIwDQYJ\nKoZIhvcNAQEBBQADggEPADCCAQoCggEBAOSCiSij4wy1wiMwvZt+rtU3IaO6ZTn9\nLfIPuGsR5/QSJk37pCZQco1LgoE/rTl+/xu3bDovyHDmgObghC6rzVOX2Tpi7kD+\nDOZpqxOsaS8ebYgxB/XJTSxyEJuSAcpSNLqqAiZivuQXdaD0N7H3Or0awwmKE9mD\nI0g8CF4fPDmuuOG0ASn9fMqXVVt5tXtEqZ9yJYfNOXx3FOPjRVOZf+kvSc31wCKe\ni/KmR0AQOmToKMzq988nLqFPTi9KZB8sEU20cGFeTQFol+m3FTcIru94EPD+nLUn\nxtlLELVspYb/PP3VpvRj9b+DY8FGJ5nfSJl7Rkje+CD4VxJpSadin3kCAwEAAaOB\nmTCBljAOBgNVHQ8BAf8EBAMCAQYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQU\ngM37P8oXmA972ztLfw+b1eIY5nowHwYDVR0jBBgwFoAUj4YAIxRwrBy0QMRKLnD0\nkVidIuYwMwYDVR0RBCwwKoIoVmF1bHQgVGVzdGluZyBJbnRlcm1lZGlhdGUgU3Vi\nIEF1dGhvcml0eTANBgkqhkiG9w0BAQsFAAOCAQEAA4buJuPNJvA1kiATLw1dVU2J\nHPubk2Kp26Mg+GwLn7Vz45Ub133JCYfF3/zXLFZZ5Yub9gWTtjScrvNfQTAbNGdQ\nBdnUlMmIRmfB7bfckhryR2R9byumeHATgNKZF7h8liNHI7X8tTzZGs6wPdXOLlzR\nTlM3m1RNK8pbSPOkfPb06w9cBRlD8OAbNtJmuypXA6tYyiiMYBhP0QLAO3i4m1ns\naAjAgEjtkB1rQxW5DxoTArZ0asiIdmIcIGmsVxfDQIjFlRxAkafMs74v+5U5gbBX\nwsOledU0fLl8KLq8W3OXqJwhGLK65fscrP0/omPAcFgzXf+L4VUADM4XhW6Xyg"),s("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v("\n-----END CERTIFICATE-----"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nprivate_key         -----BEGIN RSA PRIVATE KEY-----\nMIIEpgIBAAKCAQEAyQGAdOCFXZkgv04pmgOgW15b4AU2Ry+cAVE5juIh4Xpy9Hgx\nF1XthXe2Ku+S4gSZnAveoSm6oea8EvCsDfRJWSOdv5kjAviL6DZWBwH+7IcH7I61\ncd6u/20xYJc+sBAp9boMrMcp5jL4EA/6ZYkZMU0O0TIeEJYe+WBt0fQR8vWXXZJW\nadGjWorbbNLrnx5zdVBEf8MQQmXVk1Lt+Cgy/SOshOwa9LJSihz3RLBpRXDJG2Yb\n47JWewxrzve+EtKrTnSomsCWW6TT4NH6BmdwMXrA1JZB5poM1DXrP7I5Jw2ExxH3\nlzOlGqdI+l78oQsanXmoW/1bYm4NM/SNCLrCWwIDAQABAoIBAQCCbHMJY1Wl8eIJ\nv5HG2WuHXaaHqVoavo2fXTDXwWryfx1v+zz/Q0YnQBH3shPAi/OQCTOfpw/uVWTb\ndUZul3+wUyfcVmUdXGCLgBY53dWna8Z8e+zHwhISsqtDXV/TpelUBDCNO324XIIR\nCg0TLO4nyzQ+ESLo6D+Y2DTp8lBjMEkmKTd8CLXR2ycEoVykN98qPZm8keiLGO91\nI8K7aRd8uOyQ6HUfJRlzFHSuwaLReErxGTEPI4t/wVqh2nP2gGBsn3apiJ0ul6Jz\nNlYO5PqiwpeDk4ibhQBpicnm1jnEcynH/WtGuKgMNB0M4SBRBsEguO7WoKx3o+qZ\niVIaPWDhAoGBAO05UBvyJpAcz/ZNQlaF0EAOhoxNQ3h6+6ZYUE52PgZ/DHftyJPI\nY+JJNclY91wn91Yk3ROrDi8gqhzA+2Lelxo1kuZDu+m+bpzhVUdJia7tZDNzRIhI\n24eP2GdochooOZ0qjvrik4kuX43amBhQ4RHsBjmX5CnUlL5ZULs8v2xnAoGBANjq\nVLAwiIIqJZEC6BuBvVYKaRWkBCAXvQ3j/OqxHRYu3P68PZ58Q7HrhrCuyQHTph2v\nfzfmEMPbSCrFIrrMRmjUG8wopL7GjZjFl8HOBHFwzFiz+CT5DEC+IJIRkp4HM8F/\nPAzjB2wCdRdSjLTD5ph0/xQIg5xfln7D+wqU0QHtAoGBAKkLF0/ivaIiNftw0J3x\nWxXag/yErlizYpIGCqvuzII6lLr9YdoViT/eJYrmb9Zm0HS9biCu2zuwDijRSBIL\nRieyF40opUaKoi3+0JMtDwTtO2MCd8qaCH3QfkgqAG0tTuj1Q8/6F2JA/myKYamq\nMMhhpYny9+7rAlemM8ZJIqtvAoGBAKOI3zpKDNCdd98A4v7B7H2usZUIJ7gOTZDo\nXqiNyRENWb2PK6GNq/e6SrxvuclvyKA+zFnXULJoYtsj7tAH69lieGaOCc5uoRgZ\neBU7/euMj/McE6vEO3GgJawaJYCQi3uJMjvA+bp7i81+hehOfU5ZfmmbFaZSBoMh\nu+U5Vu3tAoGBANnBIbHfD3E7rqnqdpH1oRRHLA1VdghzEKgyUTPHNDzPJG87RY3c\nrRqeXepblud3qFjD60xS9BzcBijOvZ4+KHk6VIMpkyqoeNVFCJbBVCw+JGMp88+v\ne9t+2iwryh5+rnq+pg6anmgwHldptJc1XEFZA2UUQ89RP7kOGQF6IkIS\n-----END RSA PRIVATE KEY-----\nprivate_key_type    rsa\nserial_number       3e:20:32:c6:af:a7:20:4e:b1:95:67:fb:86:bc:cb:90:f4:31:b6:f3\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Vault 现在使用 "),e("code",[this._v("example-dot-com")]),this._v(" 角色配置生成一组新凭据。 在这里，我们看到动态生成的私钥和证书。 还将返回颁发CA证书和CA信任链。 CA Chain 返回信任链中的所有中间权限。\n不包括根权限，因为底层操作系统通常会信任它。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#api","aria-hidden":"true"}},[this._v("#")]),this._v(" API")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("PKI secrets 引擎有完整的 HTTP API，查看更多 "),e("a",{attrs:{href:""}},[this._v("PKI secrets engine API")]),this._v(" 详情。")])}],!1,null,null,null);n.options.__file="secrets-engines.md";e.default=n.exports}}]);