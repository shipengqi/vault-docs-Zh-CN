(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{156:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("p",[t._v("Auth 方法是 Vault 中执行身份验证的组件，负责为用户分配标识和一组策略。")]),t._v(" "),a("p",[t._v("通过使用多种身份验证方法，可以使用对你的 Vault 和你的组织的适用的身份验证方法。")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),a("p",[t._v("可以使用 CLI 或 API 启用或禁用 Auth 方法。")]),t._v(" "),t._m(4),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),a("p",[t._v("禁用 auth 方法后，将通过该方法验证的所有用户自动注销。")]),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),a("p",[t._v("“AppRole”表示一组 Vault 策略和登录约束，必须满足这些约束才能接收带有这些策略的令牌。范围可以根据需要缩小或宽泛。可以为特定计算机创建 AppRole，甚至可以为该计算机上的特定用户创建 AppRole，也可以跨机器创建服务。\n成功登录所需的凭据取决于与凭据关联的 AppRole 上设置的约束。")]),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._m(17),t._v(" "),t._m(18),t._m(19),t._v(" "),a("p",[t._v("必须事先配置好 Auth 方法，然后才能对用户或计算机进行身份验证。这些步骤通常由操作员或配置管理工具完成。")]),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._m(23),t._v(" "),t._m(24),a("p",[t._v("有关配置选项的完整列表，参阅 API 文档。")]),t._v(" "),t._m(25),t._v(" "),t._m(26),t._m(27),t._v(" "),t._m(28),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._m(32),t._v(" "),t._m(33),a("p",[t._v("有关配置选项的完整列表，参阅 API 文档。")]),t._v(" "),t._m(34),t._v(" "),t._m(35),t._m(36),t._v(" "),t._m(37),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._v(" "),t._m(42),t._v(" "),t._m(43),t._v(" "),t._m(44),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._m(56),t._v(" "),t._m(57),t._v(" "),t._m(58),t._m(59),t._v(" "),t._m(60),t._m(61),t._v(" "),a("p",[t._v("必须事先配置好 Auth 方法，然后才能对用户或计算机进行身份验证。这些步骤通常由操作员或配置管理工具完成。")]),t._v(" "),t._m(62),t._v(" "),t._m(63),t._m(64),t._v(" "),t._m(65),t._m(66),t._v(" "),t._m(67),t._m(68),t._v(" "),t._m(69),t._v(" "),t._m(70),t._m(71),t._v(" "),t._m(72),t._v(" "),t._m(73),t._v(" "),t._m(74),t._v(" "),a("p",[t._v("kubernetes auth 方法可以通过 Vault 验证 Kubernetes Service Account Token。")]),t._v(" "),t._m(75),t._v(" "),t._m(76),t._v(" "),t._m(77),t._v(" "),t._m(78),t._m(79),t._v(" "),t._m(80),t._v(" "),t._m(81),t._m(82),t._v(" "),t._m(83),t._m(84),t._v(" "),a("p",[t._v("必须事先配置好 Auth 方法，然后才能对用户或计算机进行身份验证。这些步骤通常由操作员或配置管理工具完成。")]),t._v(" "),t._m(85),t._v(" "),t._m(86),t._m(87),t._v(" "),t._m(88),t._m(89),t._v(" "),t._m(90),t._m(91),t._v(" "),a("p",[t._v("有关可用配置选项的列表，参阅 API 文档。")]),t._v(" "),t._m(92),t._v(" "),a("p",[t._v("这个 auth 方法访问 "),a("a",{attrs:{href:"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.10/#tokenreview-v1-authentication-k8s-io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kubernetes TokenReview API"),a("OutboundLink")],1),t._v(" 来验证所提供的 JWT 仍然有效。")]),t._v(" "),t._m(93),t._v(" "),a("p",[t._v("在这个 auth 方法中使用的 Service Accounts 要可以访问 TokenReview API。如果 Kubernetes 配置了使用 RBAC 角色，则应该授予这个 Service Accounts 访问此 API 的权限。\n下面的示例 ClusterRoleBinding 可用于授予这些权限:")]),t._v(" "),t._m(94),t._m(95),t._v(" "),t._m(96),t._v(" "),t._m(97),t._v(" "),t._m(98),t._v(" "),a("p",[t._v("令牌存储还可以用来绕过任何其他 auth 方法：你可以直接创建 tokens，也可以对令牌执行各种其他操作，比如更新和撤销。")]),t._v(" "),t._m(99),t._v(" "),t._m(100),t._v(" "),t._m(101),t._v(" "),t._m(102),t._m(103),t._v(" "),t._m(104),t._v(" "),t._m(105),t._v(" "),t._m(106),t._v(" "),t._m(107),t._v(" "),t._m(108),t._v(" "),t._m(109),t._v(" "),t._m(110),t._v(" "),t._m(111),t._v(" "),t._m(112),t._v(" "),t._m(113),t._m(114),t._v(" "),t._m(115),t._m(116),t._v(" "),t._m(117),t._m(118),t._v(" "),a("p",[t._v("必须事先配置好 Auth 方法，然后才能对用户或计算机进行身份验证。这些步骤通常由操作员或配置管理工具完成。")]),t._v(" "),t._m(119),t._v(" "),t._m(120),t._m(121),t._v(" "),t._m(122),t._m(123),t._v(" "),t._m(124),t._v(" "),t._m(125)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"auth-方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#auth-方法","aria-hidden":"true"}},[this._v("#")]),this._v(" Auth 方法")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("例如，在开发人员计算机上，"),s("a",{attrs:{href:""}},[this._v("GitHub 身份验证方法")]),this._v("最容易使用。 但对于服务器，"),s("a",{attrs:{href:""}},[this._v("AppRole")]),this._v(" 方法是推荐的选择。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("要了解有关身份验证的更多信息，请参阅 "),s("a",{attrs:{href:""}},[this._v("authentication concepts page")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"enabling-disabling-auth-methods"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#enabling-disabling-auth-methods","aria-hidden":"true"}},[this._v("#")]),this._v(" Enabling/Disabling Auth Methods")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault auth "),s("span",{attrs:{class:"token function"}},[this._v("enable")]),this._v(" userpass\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("启用后，auth 方法类似于 "),s("a",{attrs:{href:""}},[this._v("secrets 引擎")]),this._v("：它们挂载在 Vault 挂载表中，可以使用标准的 read/write API 进行访问和配置。 所有 auth 方法都挂载在 "),s("code",[this._v("auth/")]),this._v(" 前缀下面。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("默认情况下，auth 方法挂载到 "),s("code",[this._v("auth/<type>")]),this._v("。 例如，如果启用“github”，则可以在 "),s("code",[this._v("auth/github")]),this._v(" 上与其进行交互。 但是，此路径是可自定义的，允许具有高级用例的用户多次挂载单个 auth 方法。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault auth "),s("span",{attrs:{class:"token function"}},[this._v("enable")]),this._v(" -path"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("my-login userpass\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"approle-auth-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#approle-auth-method","aria-hidden":"true"}},[this._v("#")]),this._v(" AppRole Auth Method")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("approle")]),this._v(" auth 方法允许计算机或应用程序使用 Vault 定义的 "),s("code",[this._v("roles")]),this._v(" 进行身份验证。 "),s("code",[this._v("AppRole")]),this._v(" 的开放式设计支持各种工作流程和配置，可处理大量应用程序。 此 auth 方法面向自动化工作流程（机器和服务），对人工操作员不太有用。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"authentication"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#authentication","aria-hidden":"true"}},[this._v("#")]),this._v(" Authentication")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-cli","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the CLI")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("默认路径为 "),s("code",[this._v("/approle")]),this._v("。如果在其他路径上启用了此 auth 方法，请改为指定 "),s("code",[this._v("auth/my-path/login")]),this._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ vault "),a("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" auth/approle/login \\\n    role_id"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("db02de05-fa39-4855-059b-67221c5c2f63 \\\n    secret_id"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("6a174c20-f6de-a53c-74d2-6018fcceff64\n\nKey                Value\n---                -----\ntoken              65b74ffd-842c-fd43-1386-f7d7006e520a\ntoken_accessor     3c29bc22-5c72-11a6-f778-2bc8f48cea0e\ntoken_duration     20m0s\ntoken_renewable    "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\ntoken_policies     "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("default"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-api","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("默认端点是 "),s("code",[this._v("auth/approle/login")]),this._v("。如果在其他路径上启用了此 auth 方法，请使用该值而不是 "),s("code",[this._v("approle")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{attrs:{class:"token function"}},[this._v("curl")]),this._v(" \\\n    --request POST \\\n    --data "),s("span",{attrs:{class:"token string"}},[this._v('\'{"role_id":"988a9df-...","secret_id":"37b74931..."}\'')]),this._v(" \\\n    http://127.0.0.1:8200/v1/auth/approle/login\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("响应中，"),s("code",[this._v("token")]),this._v(" 在 "),s("code",[this._v("auth.client_token")]),this._v(" 上：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"auth"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"renewable"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" true,\n    "),a("span",{attrs:{class:"token string"}},[t._v('"lease_duration"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" 2764800,\n    "),a("span",{attrs:{class:"token string"}},[t._v('"metadata"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"policies"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{attrs:{class:"token string"}},[t._v('"default"')]),t._v(",\n      "),a("span",{attrs:{class:"token string"}},[t._v('"dev-policy"')]),t._v(",\n      "),a("span",{attrs:{class:"token string"}},[t._v('"test-policy"')]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"accessor"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"5d7fb475-07cb-4060-c2de-1ca3fcbf0c56"')]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"client_token"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"98a4c7ab-b1fe-361b-ba0b-e307aacfd587"')]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-cli-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-cli-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the CLI")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("启用 AppRole auth 方法：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault auth "),s("span",{attrs:{class:"token function"}},[this._v("enable")]),this._v(" approle\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("创建并命名一个 "),s("code",[this._v("role")]),this._v("：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ vault "),a("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" auth/approle/role/my-role \\\n    secret_id_ttl"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("10m \\\n    token_num_uses"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("10 \\\n    token_ttl"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("20m \\\n    token_max_ttl"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("30m \\\n    secret_id_num_uses"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("40\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("获取这个 "),s("code",[this._v("AppRole")]),this._v(" 的"),s("code",[this._v("RoleID")]),this._v("：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault "),s("span",{attrs:{class:"token function"}},[this._v("read")]),this._v(" auth/approle/role/my-role/role-id\nrole_id     db02de05-fa39-4855-059b-67221c5c2f63\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"4"}},[s("li",[this._v("获取针对这个 "),s("code",[this._v("AppRole")]),this._v(" 颁发的 "),s("code",[this._v("SecretID")]),this._v("：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault "),s("span",{attrs:{class:"token function"}},[this._v("write")]),this._v(" -f auth/approle/role/my-role/secret-id\nsecret_id               6a174c20-f6de-a53c-74d2-6018fcceff64\nsecret_id_accessor      c454f7e5-996e-7230-6074-6ef26b7bcf86\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-api-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-api-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("启用 AppRole auth 方法：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{attrs:{class:"token function"}},[this._v("curl")]),this._v(" \\\n    --header "),s("span",{attrs:{class:"token string"}},[this._v('"X-Vault-Token: ..."')]),this._v(" \\\n    --request POST \\\n    --data "),s("span",{attrs:{class:"token string"}},[this._v('\'{"type": "approle"}\'')]),this._v(" \\\n    http://127.0.0.1:8200/v1/sys/auth/approle\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("使用所需的策略集创建 AppRole：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{attrs:{class:"token function"}},[this._v("curl")]),this._v(" \\\n    --header "),s("span",{attrs:{class:"token string"}},[this._v('"X-Vault-Token: ..."')]),this._v(" \\\n    --request POST \\\n    --data "),s("span",{attrs:{class:"token string"}},[this._v('\'{"policies": "dev-policy,test-policy"}\'')]),this._v(" \\\n    http://127.0.0.1:8200/v1/auth/approle/role/my-role\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("获取这个 "),s("code",[this._v("AppRole")]),this._v(" 的 "),s("code",[this._v("RoleID")]),this._v("：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{attrs:{class:"token function"}},[t._v("curl")]),t._v(" \\\n    --header "),a("span",{attrs:{class:"token string"}},[t._v('"X-Vault-Token: ..."')]),t._v(" \\\n    http://127.0.0.1:8200/v1/auth/approle/role/my-role/role-id\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"data"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"role_id"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"988a9dfd-ea69-4a53-6cb6-9d6b86474bba"')]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t\t\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"4"}},[s("li",[this._v("获取针对这个 "),s("code",[this._v("AppRole")]),this._v(" 颁发的 "),s("code",[this._v("SecretID")]),this._v("：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{attrs:{class:"token function"}},[t._v("curl")]),t._v(" \\\n    --header "),a("span",{attrs:{class:"token string"}},[t._v('"X-Vault-Token: ..."')]),t._v(" \\\n    --request POST \\\n     http://127.0.0.1:8200/v1/auth/approle/role/my-role/secret-id\n\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"data"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"secret_id_accessor"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"45946873-1d96-a9d4-678c-9229f74386a5"')]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"secret_id"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"37b74931-c4cd-d49a-9246-ccc62d682a25"')]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t\t \n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"credentials-constraints"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#credentials-constraints","aria-hidden":"true"}},[this._v("#")]),this._v(" Credentials/Constraints")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"roleid"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#roleid","aria-hidden":"true"}},[this._v("#")]),this._v(" RoleID")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("RoleID 是一个标识符，用于选择评估其他凭据的 AppRole。 使用 AppRole auth 方法的登录端点进行身份验证时，RoleID 始终是必需的参数（通过 "),s("code",[this._v("role_id")]),this._v("）。 默认情况下，RoleID 是唯一的 UUID，\n允许它们作为其他凭据信息的辅助 secrets。但是，可以将它们设置为特定值以匹配客户端的内省信息（例如，客户端的域名）。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"secretid"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secretid","aria-hidden":"true"}},[this._v("#")]),this._v(" SecretID")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("SecretID 是所有登录（通过 "),a("code",[t._v("secret_id")]),t._v("）默认所需的凭证，并且始终是加密的。（对于高级用法，可以通过 "),a("code",[t._v("AppRole")]),t._v(" 的 "),a("code",[t._v("bind_secret_id")]),t._v(" 参数禁用 "),a("code",[t._v("SecretID")]),t._v("，允许只知道 "),a("code",[t._v("RoleID")]),t._v(" 或者匹配其他设置约束\n的计算机去获取令牌）。通过 "),a("code",[t._v("role")]),t._v(" 本身（Pull 模式）或通过特定的自定义值（ Push 模式）生成 128 位纯随机 UUID，可以针对 AppRole 创建 SecretID。与令牌类似，SecretID 具有使用限制，TTL 和过期等属性。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h5",{attrs:{id:"pull-and-push-secretid-modes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pull-and-push-secretid-modes","aria-hidden":"true"}},[this._v("#")]),this._v(" Pull And Push SecretID Modes")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果用于登录的 SecretID 是从 AppRole 获取的，则它在 Pull 模式下运行。 如果客户端针对 AppRole 设置“自定义” SecretID，则将其称为推送模式。推模式模仿已弃用的 "),s("code",[this._v("App-ID")]),this._v(" auth方法的行为;但是，\n在大多数情况下，Pull 模式是更好的方法。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"further-constraints"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#further-constraints","aria-hidden":"true"}},[this._v("#")]),this._v(" Further Constraints")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("code",[t._v("role_id")]),t._v(" 是 "),a("code",[t._v("login")]),t._v(" 端点的必需凭据。"),a("code",[t._v("role_id")]),t._v(" 指向的 AppRole 将设置约束。这决定了登录所需的其他凭据。"),a("code",[t._v("bind_secret_id")]),t._v(" 约束要求在登录端点传递 "),a("code",[t._v("secret_id")]),t._v("。这个 auth方法可以支持更多约束参数，以支持各种应用程序集。 某些约束不需要凭证，但仍然强制执行登录约束。 例如，"),a("code",[t._v("secret_id_bound_cidrs")]),t._v("将仅允许来自属于AppRole上配置的CIDR块的IP地址的登录。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api","aria-hidden":"true"}},[this._v("#")]),this._v(" API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("AppRole auth 方法有完整的 HTTP API，查看更多 "),s("a",{attrs:{href:""}},[this._v("AppRole API")]),this._v("详情。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"github-auth-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#github-auth-method","aria-hidden":"true"}},[this._v("#")]),this._v(" GitHub Auth Method")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("github")]),this._v(" auth 方法使 Vault 可以使用 github GitHub personal access token 进行身份验证。这种身份验证方法对\n直接通过 CLI 使用 Vault 的操作人员或开发人员最有用。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Vault 不支持生成 GitHub token 的 OAuth 工作流，因此不能当做 GitHub 应用程序。因此，该方法使用 personal access token。一个重要的结果是，\n任何具有 "),s("code",[this._v("read:org")]),this._v(" 作用域的有效 GitHub 访问令牌都可以用于身份验证。如果这样的令牌从第三方服务中被窃取，并且攻击者能够对 Vault 进行网络调用，那么他们将能够作为\n生成了访问令牌的用户进行登录。使用此方法时，最好确保 Vault 的访问限制在网络级别，而不是公共级别。如果你不能接受这些风险，你应该使用不同的方法。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"authentication-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#authentication-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Authentication")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-cli-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-cli-3","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the CLI")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("默认路径为 "),s("code",[this._v("/github")]),this._v("。如果在不同的路径上启用了此 auth 方法，使用 CLI 指定 "),s("code",[this._v("-path=/my-path")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault login -method"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("github token"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),s("span",{attrs:{class:"token string"}},[this._v('"MY_TOKEN"')]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-api-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-api-3","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("默认端点是 "),s("code",[this._v("auth/github/login")]),this._v("。如果在不同的路径上启用了此 auth 方法，请使用该值替换 "),s("code",[this._v("kubernetes")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{attrs:{class:"token function"}},[this._v("curl")]),this._v(" \\\n    --request POST \\\n    --data "),s("span",{attrs:{class:"token string"}},[this._v('\'{"token": "MY_TOKEN"}\'')]),this._v(" \\\n    http://127.0.0.1:8200/v1/auth/github/login\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("响应中，"),s("code",[this._v("token")]),this._v(" 在 "),s("code",[this._v("auth.client_token")]),this._v(" 上：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"auth"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"renewable"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" true,\n    "),a("span",{attrs:{class:"token string"}},[t._v('"lease_duration"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" 2764800,\n    "),a("span",{attrs:{class:"token string"}},[t._v('"metadata"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token string"}},[t._v('"username"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"my-user"')]),t._v(",\n      "),a("span",{attrs:{class:"token string"}},[t._v('"org"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"my-org"')]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"policies"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{attrs:{class:"token string"}},[t._v('"default"')]),t._v(",\n      "),a("span",{attrs:{class:"token string"}},[t._v('"dev-policy"')]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"accessor"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"f93c4b2d-18b6-2b50-7a32-0fecf88237b8"')]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"client_token"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"1977fceb-3bfa-6c71-4d1f-b64af98ac018"')]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"configuration-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("启用 Github auth 方法：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault auth "),s("span",{attrs:{class:"token function"}},[this._v("enable")]),this._v(" github\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("通过 "),s("code",[this._v("/config")]),this._v(" 端点配置 Vault 与 Github 通信。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault "),s("span",{attrs:{class:"token function"}},[this._v("write")]),this._v(" auth/github/config organization"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("hashicorp\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v('将 GitHub 组织的 users/teams 映射到 Vault 的策略。teams 名称必须是 "slugified"')])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault "),s("span",{attrs:{class:"token function"}},[this._v("write")]),this._v(" auth/github/map/teams/dev value"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("dev-policy\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v('在本例中，当组织 "hashicorp" 中的 team"dev" 的成员使用 GitHub personal access token 对 Vault 进行身份验证时，\n将给他们一个附带 '),s("code",[this._v("dev-policy")]),this._v(" 策略的令牌。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("你还可以为指定的用户创建映射，使用 "),s("code",[this._v("map/users/<user>")]),this._v(" ：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("$ vault write auth/github/map/users/sethvargo value=sethvargo-policy\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在本例中，除了其他的 team 策略外，还会为 GitHub 用户名为 "),s("code",[this._v("sethvargo")]),this._v(" 的用户分配 "),s("code",[this._v("sethvargo-policy")]),this._v(" 策略。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"api-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-2","aria-hidden":"true"}},[this._v("#")]),this._v(" API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("GitHub auth 方法有完整的 HTTP API，查看更多 "),s("a",{attrs:{href:""}},[this._v("GitHub auth method API")]),this._v(" 详情。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"kubernetes-auth-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-auth-method","aria-hidden":"true"}},[this._v("#")]),this._v(" Kubernetes Auth Method")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"authentication-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#authentication-3","aria-hidden":"true"}},[this._v("#")]),this._v(" Authentication")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-cli-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-cli-4","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the CLI")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("默认路径为 "),s("code",[this._v("/kubernetes")]),this._v("。如果在不同的路径上启用了此 auth 方法，使用 CLI 指定 "),s("code",[this._v("-path=/my-path")]),this._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ vault "),a("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" auth/kubernetes/login role"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("demo jwt"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-api-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-api-4","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("默认端点是 "),s("code",[this._v("auth/kubernetes/login")]),this._v("。如果在不同的路径上启用了此 auth 方法，请使用该值替换 "),s("code",[this._v("kubernetes")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{attrs:{class:"token function"}},[this._v("curl")]),this._v(" \\\n    --request POST \\\n    --data "),s("span",{attrs:{class:"token string"}},[this._v('\'{"jwt": "your_service_account_jwt", "role": "demo"}\'')]),this._v(" \\\n    http://127.0.0.1:8200/v1/auth/kubernetes/login\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("响应中，"),s("code",[this._v("token")]),this._v(" 在 "),s("code",[this._v("auth.client_token")]),this._v(" 上：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"auth"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"client_token"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"38fe9691-e623-7238-f618-c94d4e7bc674"')]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"accessor"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"78e87a38-84ed-2692-538f-ca8b9f400ab3"')]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"policies"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{attrs:{class:"token string"}},[t._v('"default"')]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"metadata"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token string"}},[t._v('"role"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"demo"')]),t._v(",\n      "),a("span",{attrs:{class:"token string"}},[t._v('"service_account_name"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"vault-auth"')]),t._v(",\n      "),a("span",{attrs:{class:"token string"}},[t._v('"service_account_namespace"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"default"')]),t._v(",\n      "),a("span",{attrs:{class:"token string"}},[t._v('"service_account_secret_name"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"vault-auth-token-pd21c"')]),t._v(",\n      "),a("span",{attrs:{class:"token string"}},[t._v('"service_account_uid"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"aa9aa8ff-98d0-11e7-9bb7-0800276d99bf"')]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"lease_duration"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" 2764800,\n    "),a("span",{attrs:{class:"token string"}},[t._v('"renewable"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"configuration-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration-3","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("启用 Kubernetes auth 方法：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault auth "),s("span",{attrs:{class:"token function"}},[this._v("enable")]),this._v(" kubernetes\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("通过 "),s("code",[this._v("/config")]),this._v(" 端点配置 Vault 与 Kubernetes 通信。有关可用配置选项的列表，参阅 API 文档：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ vault "),a("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" auth/kubernetes/config \\\n    token_reviewer_jwt"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"reviewer_service_account_jwt"')]),t._v(" \\\n    kubernetes_host"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("https://192.168.99.100:8443 \\\n    kubernetes_ca_cert"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("@ca.crt\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("创建一个指定的 role：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("vault "),a("span",{attrs:{class:"token function"}},[t._v("write")]),t._v(" auth/kubernetes/role/demo \\\n    bound_service_account_names"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("vault-auth \\\n    bound_service_account_namespaces"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("default \\\n    policies"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("default \\\n    ttl"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("1h\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这个 role 授权 "),s("code",[this._v("default")]),this._v(" 命名空间中的 "),s("code",[this._v("vault-auth")]),this._v(" service account ，并为其提供 "),s("code",[this._v("default")]),this._v(" 策略。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"configuring-kubernetes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuring-kubernetes","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuring Kubernetes")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Kubernetes 应该使用 "),s("code",[this._v("--service-account-lookup")]),this._v(" 来运行。这在 Kubernetes 1.7 中默认为 "),s("code",[this._v("true")]),this._v(" ，但是之前的任何版本都应该确保 Kubernetes API 服务器启动时使用了该设置。\n否则，在 Kubernetes 中删除的令牌将不会被正确地撤销，并且将能够对这个 auth 方法进行身份验证。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1beta1\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRoleBinding\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" role"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tokenreview"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("binding\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("roleRef")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("apiGroup")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" system"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("auth"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("delegator\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("subjects")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" vault"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"api-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-3","aria-hidden":"true"}},[this._v("#")]),this._v(" API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Kubernetes Auth Plugin 有完整的 HTTP API，查看更多 "),s("a",{attrs:{href:""}},[this._v("API")]),this._v(" 详情。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"token-auth-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#token-auth-method","aria-hidden":"true"}},[this._v("#")]),this._v(" Token Auth Method")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("token")]),this._v(" 方法是内置的，并且在 "),s("code",[this._v("/auth/token")]),this._v(" 路径上自动启用。它允许用户使用令牌进行身份验证，以及创建新令牌、按令牌撤销机密等等。\n当任何其他 auth 方法返回一个身份标识时，Vault core 调用令牌方法为该标识创建一个新的唯一的令牌。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("请查看专用于令牌的 "),s("a",{attrs:{href:""}},[this._v("token concepts")]),this._v(" 页面。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"authentication-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#authentication-4","aria-hidden":"true"}},[this._v("#")]),this._v(" Authentication")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-cli-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-cli-5","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the CLI")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("$ vault login token=<token>\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-api-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-api-5","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("令牌被直接设置为 HTTP API 的头。报头应该是 "),s("code",[this._v("X-VAULT-TOKEN: <token>")]),this._v(" 或 "),s("code",[this._v("Authorization: Bearer <token>")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"api-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-4","aria-hidden":"true"}},[this._v("#")]),this._v(" API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Token auth 方法有完整的 HTTP API，查看更多 "),s("a",{attrs:{href:""}},[this._v("Token auth method API")]),this._v(" 详情。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"userpass-auth-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#userpass-auth-method","aria-hidden":"true"}},[this._v("#")]),this._v(" Userpass Auth Method")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Userpass")]),this._v(" auth 方法允许用户使用一个 username 和 password 对 Vault 进行身份验证。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("username/password 组合使用 "),s("code",[this._v("users/")]),this._v("路径直接配置到 auth 方法。此方法无法从外部源读取用户名和密码。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Userpass")]),this._v(" auth 方法会把所有提交的用户名转化为小写，例如 "),s("code",[this._v("Mary")]),this._v(" 和 "),s("code",[this._v("mary")]),this._v("是相同的条目。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"authentication-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#authentication-5","aria-hidden":"true"}},[this._v("#")]),this._v(" Authentication")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-cli-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-cli-6","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the CLI")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault login -method"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("userpass \\\n    username"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("mitchellh \\\n    password"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("foo\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"via-the-api-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#via-the-api-6","aria-hidden":"true"}},[this._v("#")]),this._v(" Via the API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{attrs:{class:"token function"}},[this._v("curl")]),this._v(" \\\n    --request POST \\\n    --data "),s("span",{attrs:{class:"token string"}},[this._v('\'{"password": "foo"}\'')]),this._v(" \\\n    http://127.0.0.1:8200/v1/auth/userpass/login/mitchellh\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("响应中，"),s("code",[this._v("token")]),this._v(" 在 "),s("code",[this._v("auth.client_token")]),this._v(" 上：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"lease_id"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('""')]),t._v(",\n  "),a("span",{attrs:{class:"token string"}},[t._v('"renewable"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" false,\n  "),a("span",{attrs:{class:"token string"}},[t._v('"lease_duration"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" 0,\n  "),a("span",{attrs:{class:"token string"}},[t._v('"data"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" null,\n  "),a("span",{attrs:{class:"token string"}},[t._v('"auth"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"client_token"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"c4f280f6-fdb2-18eb-89d3-589e2e834cdb"')]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"policies"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{attrs:{class:"token string"}},[t._v('"admins"')]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"metadata"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token string"}},[t._v('"username"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"mitchellh"')]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    "),a("span",{attrs:{class:"token string"}},[t._v('"lease_duration"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" 0,\n    "),a("span",{attrs:{class:"token string"}},[t._v('"renewable"')]),a("span",{attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"configuration-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration-4","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("启用 Userpass auth 方法：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault auth "),s("span",{attrs:{class:"token function"}},[this._v("enable")]),this._v(" userpass\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("配置允许认证的用户：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ vault "),s("span",{attrs:{class:"token function"}},[this._v("write")]),this._v(" auth/userpass/users/mitchellh \\\n    password"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("foo \\\n    policies"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v("admins\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这会创建一个名为 "),s("code",[this._v("mitchellh")]),this._v(" 的新用户，密码为 "),s("code",[this._v("foo")]),this._v(" ，该用户将与“管理员”策略相关联。这是唯一必须的配置。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"api-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-5","aria-hidden":"true"}},[this._v("#")]),this._v(" API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Userpass  auth 方法有完整的 HTTP API，查看更多 "),s("a",{attrs:{href:""}},[this._v("Userpass auth method API")]),this._v(" 详情。")])}],!1,null,null,null);n.options.__file="auth-methods.md";s.default=n.exports}}]);