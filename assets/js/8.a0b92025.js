(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{157:function(t,e,s){"use strict";s.r(e);var i=s(0),a=Object(i.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),s("p",[t._v("审计设备是 Vault 保存所有请求和响应详细日志的组件。因为 Vault 的每个操作都是一个 API 请求/响应，所以审计日志包含与 Vault 的每个经过身份验证的交互，\n包括错误。")]),t._v(" "),s("p",[t._v("可以启用多个审计设备，Vault 将向这每个设备发送审计日志。这不仅允许拥有一个冗余副本，而且还允许拥有第二个副本，以防第一个副本被篡改。、")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),s("p",[t._v("当启用审计设备时，可以将选项传递给它来配置它。例如，下面的命令启用文件审计设备:")]),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._v(" "),s("p",[t._v("如果启用了任意审计设备，在完成一个 Vault 请求之前，Vault 要求至少要有一个持久化日志。")]),t._v(" "),t._m(12),t._v(" "),s("p",[t._v("如果你有多个审计设备，那么只要有一个审计设备可以保存日志，Vault 就会完成请求。")]),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),s("p",[t._v("该设备目前不支持任何 log rotation （日志滚动）。已经有非常稳定且功能丰富的 log rotation 工具，因此建议使用现有的工具。")]),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),s("p",[t._v("在默认的路径上启用：")]),t._v(" "),t._m(20),s("p",[t._v("在不同的路径上启用。可以启用审计设备的多个副本:")]),t._v(" "),t._m(21),t._m(22),t._v(" "),t._m(23),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),s("p",[t._v("目前不支持可配置的 syslog 目的地，并且总是发送到本地代理。此设备仅在 Unix 系统上受支持，如果任何备用 Vault 实例不支持该设备，则不应启用该设备。")]),t._v(" "),s("blockquote",[s("p",[t._v("某些操作生成的审计消息可能非常大，并且可能比 "),s("a",{attrs:{href:"https://tools.ietf.org/html/rfc5426#section-3.1",target:"_blank",rel:"noopener noreferrer"}},[t._v("maximum-size single UDP packet"),s("OutboundLink")],1),t._v(" 还要大。\n如果可能，使用的 syslog 守护进程，配置一个 TCP 侦听器。否则，请考虑使用 "),s("code",[t._v("file")]),t._v(" 后端，并将 "),s("code",[t._v("syslog")]),t._v(" 配置为从文件中读取条目。或者，\n同时启用 "),s("code",[t._v("file")]),t._v(" 和 "),s("code",[t._v("syslog")]),t._v("，以便特定消息不能直接写入到 "),s("code",[t._v("syslog")]),t._v("，不会导致 Vault 被阻塞。")])]),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._m(32),t._v(" "),t._m(33),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),s("p",[t._v("在默认的路径上启用：")]),t._v(" "),t._m(40),t._m(41),t._v(" "),t._m(42),t._m(43),t._v(" "),s("ul",[t._m(44),t._v(" "),s("li",[s("code",[t._v("socket_type")]),t._v(" "),s("code",[t._v('(string: "tcp")')]),t._v(" - 要使用的套接字类型，可以接受任何与 "),s("a",{attrs:{href:"https://golang.org/pkg/net/#Dial",target:"_blank",rel:"noopener noreferrer"}},[t._v("net.Dial"),s("OutboundLink")],1),t._v(" 兼容的类型。")]),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49)])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"audit-devices"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#audit-devices","aria-hidden":"true"}},[this._v("#")]),this._v(" Audit Devices")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"overview"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#overview","aria-hidden":"true"}},[this._v("#")]),this._v(" Overview")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"format"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#format","aria-hidden":"true"}},[this._v("#")]),this._v(" Format")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("审计日志中的每一行都是一个 JSON 对象。"),e("code",[this._v("type")]),this._v(" 字段指定对象的类型。目前，只存在两种类型: "),e("code",[this._v("request")]),this._v(" 和 "),e("code",[this._v("response")]),this._v("。这一行包含任何给定请求和响应的所有信息。\n默认情况下，所有敏感信息在记录到审计日志之前都要先进行 hash。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"sensitive-information"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sensitive-information","aria-hidden":"true"}},[this._v("#")]),this._v(" Sensitive Information")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("审计日志包含了与 Vault 每次交互的完整请求和响应对象。可以使用分配给每个请求的唯一标识符来匹配请求和响应。请求中的数据和响应中的数据(包括 secrets 和 tokens )将\n加 salt 并使用 "),e("code",[this._v("HMAC-SHA256")]),this._v(" 进行散列。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("散列的目的是使 secrets 不在审计日志中以明文形式显示。但是，你仍然可以通过自己生成 HMACs 来检查 secrets 的 value。可以通过审计设备的 hash 函数和 salt\n并使用 "),e("code",[this._v("/sys/audit-hash")]),this._v(" API 来完成(有关详细信息，请参阅文档)。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"enabling-disabling-audit-devices"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#enabling-disabling-audit-devices","aria-hidden":"true"}},[this._v("#")]),this._v(" Enabling/Disabling Audit Devices")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("首次初始化 Vault 服务器时，默认不启用审计。root 用户必须使用 "),e("code",[this._v("vault audit enable")]),this._v(" 启用审计设备。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault audit enable file file_path=/var/log/vault_audit.log\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("上面的命令，传入了 "),e("code",[this._v("file_path")]),this._v(" 参数来指定审计日志写入的文件路径。每个审计设备都有自己的一组参数。有关详细信息，请参阅文档。\n当审计设备被禁用时，会立即停止接收日志。存储的现有日志不会受到影响。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"blocked-audit-devices"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#blocked-audit-devices","aria-hidden":"true"}},[this._v("#")]),this._v(" Blocked Audit Devices")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("如果你只启用了一个审计设备，并且它正在阻塞(网络阻塞等)，那么 Vault 将不响应。Vault 不会完成任何请求直到在审计设备可以写入。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果审计设备被阻塞，Vault 将不会响应请求，因为审计日志非常重要，忽略被阻塞的请求容易被攻击。一定要"),e("strong",[this._v("确保审计设备不会阻塞")]),this._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#api","aria-hidden":"true"}},[this._v("#")]),this._v(" API")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Audit devices 方法有完整的 HTTP API，查看更多 "),e("a",{attrs:{href:""}},[this._v("Audit devices API")]),this._v(" 详情。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"file-audit-device"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#file-audit-device","aria-hidden":"true"}},[this._v("#")]),this._v(" File Audit Device")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("file")]),this._v(" 审计设备将审计日志写入文件。这是一个非常简单的审计设备: 将日志附加到文件中。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("向 Vault 进程发送 "),e("code",[this._v("SIGHUP")]),this._v(" 将导致文件审计设备关闭和重新打开它们的底层文件，这有助于满足 log rotation 的需要。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"examples"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#examples","aria-hidden":"true"}},[this._v("#")]),this._v(" Examples")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault audit enable file file_path=/var/log/vault_audit.log\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('$ vault audit enable -path="vault_audit_1" file file_path=/home/user/vault_audit.log\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("启用 "),e("code",[this._v("stdout")]),this._v(" 上的日志。这在容器中运行时非常有用:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault audit enable file file_path=stdout\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("注意 "),e("code",[this._v("audit enable")]),this._v(" 命令选项和文件后端配置选项之间的区别。使用 "),e("code",[this._v("vault audit enable -help")]),this._v(" 查看命令选项。下面是后端可用的配置选项。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("file_path")]),t._v(" "),s("code",[t._v("(string: <required>)")]),t._v(" - 将写入审计日志的路径。如果在给定路径上已经存在一个文件，审计后端将追加到该文件。有一些特殊的关键词:\n"),s("ul",[s("li",[s("code",[t._v("stdout")]),t._v(" 将审计日志写到标准输出")]),t._v(" "),s("li",[s("code",[t._v("discard")]),t._v(" 写入输出(在测试场景中非常有用)")])])]),t._v(" "),s("li",[s("code",[t._v("log_raw")]),t._v(" "),s("code",[t._v("bool: false")]),t._v(" - 如果启用，log 不会对敏感信息 hash。")]),t._v(" "),s("li",[s("code",[t._v("hmac_accessor")]),t._v(" "),s("code",[t._v("(bool: true)")]),t._v(" - 如果启用，会对 token 进行 hash。")]),t._v(" "),s("li",[s("code",[t._v("mode")]),t._v(" "),s("code",[t._v('(string: "0600")')]),t._v(" - 包含了表示文件模式位模式的八进制数的字符串，类似 "),s("code",[t._v("chmod")]),t._v("。设置为 "),s("code",[t._v("0000")]),t._v(" 以防止 Vault 修改文件模式。")]),t._v(" "),s("li",[s("code",[t._v("format")]),t._v(" "),s("code",[t._v('(string: "json")')]),t._v(" - 允许选择输出格式。有效值是 "),s("code",[t._v("json")]),t._v(" 和 "),s("code",[t._v("jsonx")]),t._v(" ，将普通日志条目格式化为 XML。")]),t._v(" "),s("li",[s("code",[t._v("prefix")]),t._v(" "),s("code",[t._v('(string: "")')]),t._v(" - 在实际日志行之前写入的自定义的字符串前缀。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"syslog-audit-device"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#syslog-audit-device","aria-hidden":"true"}},[this._v("#")]),this._v(" Syslog Audit Device")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("syslog")]),this._v(" 审计设备将审计日志写入 syslog。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"examples-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#examples-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Examples")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("syslog")]),this._v(" 审计设备可以使用下面的命令启用：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault audit enable syslog\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("通过 "),e("code",[this._v("K=V")]),this._v(" 对 提供配置参数:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('$ vault audit enable syslog tag="vault" facility="AUTH"\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"configuration-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("facility")]),t._v(" "),s("code",[t._v('(string: "AUTH")')]),t._v(" - 要使用的 syslog 工具。")]),t._v(" "),s("li",[s("code",[t._v("tag")]),t._v(" "),s("code",[t._v('(string: "vault")')]),t._v(" - 要使用的 syslog 标签。")]),t._v(" "),s("li",[s("code",[t._v("log_raw")]),t._v(" "),s("code",[t._v("bool: false")]),t._v(" - 如果启用，log 不会对敏感信息 hash。")]),t._v(" "),s("li",[s("code",[t._v("hmac_accessor")]),t._v(" "),s("code",[t._v("(bool: true)")]),t._v(" - 如果启用，会对 token 进行 hash。")]),t._v(" "),s("li",[s("code",[t._v("mode")]),t._v(" "),s("code",[t._v('(string: "0600")')]),t._v(" - 包含了表示文件模式位模式的八进制数的字符串，类似 "),s("code",[t._v("chmod")]),t._v("。设置为 "),s("code",[t._v("0000")]),t._v(" 以防止 Vault 修改文件模式。")]),t._v(" "),s("li",[s("code",[t._v("format")]),t._v(" "),s("code",[t._v('(string: "json")')]),t._v(" - 允许选择输出格式。有效值是 "),s("code",[t._v("json")]),t._v(" 和 "),s("code",[t._v("jsonx")]),t._v(" ，将普通日志条目格式化为 XML。")]),t._v(" "),s("li",[s("code",[t._v("prefix")]),t._v(" "),s("code",[t._v('(string: "")')]),t._v(" - 在实际日志行之前写入的自定义的字符串前缀。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"socket-audit-device"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#socket-audit-device","aria-hidden":"true"}},[this._v("#")]),this._v(" Socket Audit Device")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("socket")]),this._v(" 审计设备写入 TCP、UDP 或 UNIX 套接字。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("由于该设备中使用的底层协议的性质，存在这样一种情况，当到套接字的连接丢失时，日志中可以省略一个审计条目，而请求仍然会成功。\n将此设备与另一个审计设备一起使用将有助于提高准确性，但如果审计日志需要保证，则不应使用套接字设备。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"enabling"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#enabling","aria-hidden":"true"}},[this._v("#")]),this._v(" Enabling")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault audit enable socket\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("通过 "),e("code",[this._v("K=V")]),this._v(" 对 提供配置参数:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ vault audit enable socket address=127.0.0.1:9090 socket_type=tcp\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"configuration-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration-3","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",[s("code",[t._v("address")]),t._v(" "),s("code",[t._v('(string: "")')]),t._v(" - 要使用的套接字服务器地址。例 "),s("code",[t._v("127.0.0.1:9090")]),t._v(" 或 "),s("code",[t._v("/tmp/audit.sock")]),t._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("code",[this._v("log_raw")]),this._v(" "),e("code",[this._v("bool: false")]),this._v(" - 如果启用，log 不会对敏感信息 hash。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("code",[this._v("hmac_accessor")]),this._v(" "),e("code",[this._v("(bool: true)")]),this._v(" - 如果启用，会对 token 进行 hash。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",[s("code",[t._v("mode")]),t._v(" "),s("code",[t._v('(string: "0600")')]),t._v(" - 包含了表示文件模式位模式的八进制数的字符串，类似 "),s("code",[t._v("chmod")]),t._v("。设置为 "),s("code",[t._v("0000")]),t._v(" 以防止 Vault 修改文件模式。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",[s("code",[t._v("format")]),t._v(" "),s("code",[t._v('(string: "json")')]),t._v(" - 允许选择输出格式。有效值是 "),s("code",[t._v("json")]),t._v(" 和 "),s("code",[t._v("jsonx")]),t._v(" ，将普通日志条目格式化为 XML。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("code",[this._v("prefix")]),this._v(" "),e("code",[this._v('(string: "")')]),this._v(" - 在实际日志行之前写入的自定义的字符串前缀。")])}],!1,null,null,null);a.options.__file="audit-device.md";e.default=a.exports}}]);